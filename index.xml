<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Sinowrt on Sinowrt</title>
    <link>http://blog.sinowrt.cn/</link>
    <description>Recent content in Sinowrt on Sinowrt</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 03 May 2022 21:45:00 +0800</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>巧用IOS的BLE实现上下班打卡提醒（Python实现）</title>
      <link>http://blog.sinowrt.cn/2022/2022-05-03t2145-using-ios-ble-to-remind-me-clock-inpython-implement/</link>
      <pubDate>Tue, 03 May 2022 21:45:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2022/2022-05-03t2145-using-ios-ble-to-remind-me-clock-inpython-implement/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;因为公司使用刷脸打卡，这就导致有时候打了卡，却突然失忆，忘了自己有没有打卡；或者直接就忘了打卡，并且也忘了自己有没有打卡。这几种情况都实实在在发生过的，上个班还要时时刻刻去回忆有没有打卡实在是非常痛苦的一件事。所以一直就想做一个提醒打卡的小程序。&lt;/p&gt;

&lt;h2 id=&#34;0x01-设想的几种方案&#34;&gt;0x01 设想的几种方案&lt;/h2&gt;

&lt;p&gt;第一种方案，是基于IOS快捷指令的自动化功能，设置到达或者离开目的地的提醒，但是这个自动化的方式非常鸡肋，一个是触发之后，还要手动点运行；二是到达或离开目的地根本就不提醒，反而是每次走到定位地址外的一个准确位置，反而又会准确提醒，不知道是不是地图位置有偏移还是咋滴。&lt;/p&gt;

&lt;p&gt;第二种方案是想起之前阿里公众号中的一篇&lt;a href=&#34;https://mp.weixin.qq.com/s/7jVa-K-qUlYIrCg3YpPSEQ&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;文章&lt;/a&gt;，就讲到在外卖取餐的场景中，如何准确识别外卖小哥到店取餐的解决方案，这给了我很大的启发，该场景跟我上下班的场景很是契合，只要在到店（到公司上班）识别的基础上，加上离店（下班回家）识别的功能即可。开干！&lt;/p&gt;

&lt;h2 id=&#34;0x02-资料收集&#34;&gt;0x02 资料收集&lt;/h2&gt;

&lt;p&gt;遵循不重复造轮子原则，我首先在网上搜集了一下相关的信息，看看有没有现成的方案。&lt;/p&gt;

&lt;p&gt;首先在知乎找到了&lt;a href=&#34;https://zhuanlan.zhihu.com/p/136898412&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;《总是忘打卡？用iBeacon提醒你！》&lt;/a&gt;这篇文章，作者在万能淘宝上购买的iBeacon信标，使用Python搭配pybluez库探测iBeacon信号，根据iBeacon信号的消失或者出现来判断作者上班与下班的状态。&lt;/p&gt;

&lt;p&gt;但是据了解，iPhone是会持续向外发射BLE信号的，既然有现成的信号源，就不用买万能淘宝的iBeacon信标了。&lt;/p&gt;

&lt;p&gt;因为iPhone的BLE广播的是随机地址，那么要如何唯一确定该随机地址是我的设备呢? 首先我们要知道随机地址是什么意思，随机地址是蓝牙核心规范中的一个词条，那么在蓝牙核心规范中必然会有&amp;rdquo;随机地址&amp;rdquo;的定义和描述，附上&lt;a href=&#34;https://www.bluetooth.com/zh-cn/specifications/specs/core-specification-5-3/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;蓝牙核心规范5.3下载链接&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&#34;0x03-实现方案&#34;&gt;0x03 实现方案&lt;/h2&gt;

&lt;p&gt;根据蓝牙核心规范5.3中&lt;code&gt;[Vol 6] Part B, Section 1.3.2.3&lt;/code&gt;的描述，可解析随机地址（iPhone BLE使用的正是可解析随机地址）可以使用设备配对过程中产生的IRK进行解析&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;将IRK以及随机地址的前24位prand作为输入，然后prand需要补齐128位变为r&amp;rsquo;&lt;/li&gt;
&lt;li&gt;使用&lt;code&gt;[Vol 3] Part H, Section 2.2.2&lt;/code&gt;的ah哈希函数，进行ah(IRK,r&amp;rsquo;)，ah函数实际上就是&lt;a href=&#34;https://csrc.nist.gov/csrc/media/publications/fips/197/final/documents/fips-197.pdf&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;NIST Publication FIPS-197&lt;/a&gt;中描述的AES-128加密，IRK作为key，r&amp;rsquo;作为plaintext&lt;/li&gt;
&lt;li&gt;取ah哈希运算结果的最后24位，跟随机地址的后24位进行比较，若一样则可判断为同一设备。&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;0x04-运行环境的选择&#34;&gt;0x04 运行环境的选择&lt;/h2&gt;

&lt;p&gt;我脑海中最先想到的是树莓派，作为一个wifi 蓝牙 有线功能完备，软件支持完整，即插即用，并且技术成熟的ARM设备，确实是实现各种小功能的首选设备。&lt;/p&gt;

&lt;p&gt;等等，为什么不在windows中实现呢？我的办公电脑又是24小时开机的，少维护一个设备多香啊。但是在实现的过程中发现pybluez的库在windows平台上并不支持BLE。。。但是万能的GayHub说：pybluez不行我这还有pysimpleble，尽管文档少，又不是不能用对吧。&lt;/p&gt;

&lt;h2 id=&#34;0x05-获取irk&#34;&gt;0x05 获取IRK&lt;/h2&gt;

&lt;p&gt;既然随机地址是根据IRK来解析的，那首先就要获取到一个IRK。&lt;/p&gt;

&lt;p&gt;首先，需要一个支持BLE的蓝牙适配器（我两台电脑蓝牙适配器可能因为不支持BLE配对，只能获取到Linkkey），以及Win10系统环境。&lt;/p&gt;

&lt;p&gt;将电脑与手机进行配对，配对完成后，打开设备管理器，找到iPhone的蓝牙LE设备，打开属性窗口的事件选项卡，在信息栏记录蓝牙LE设备的设备号（如图5.1）&lt;br /&gt;
&lt;img src=&#34;https://pic.sinowrt.cn/blogpics/20220508181736.jpg&#34; alt=&#34;图 5.1&#34; /&gt;&lt;br /&gt;
下载&lt;a href=&#34;https://docs.microsoft.com/en-us/sysinternals/downloads/psexec&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;PsTools&lt;/a&gt;解压,使用管理员权限打开CMD，cd到解压好的PsTools根目录，执行命令&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;# 64位操作系统执行以下命令
PsExec64.exe -si regedit
# 32位操作系统执行以下命令
PsExec.exe -si regedit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;执行命令后会打开注册表窗口，在左侧找到&lt;code&gt;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\BTHPORT\Parameters\Keys\&lt;/code&gt;目录(如图 5.2)&lt;br /&gt;
&lt;img src=&#34;https://pic.sinowrt.cn/blogpics/20220508181400.png&#34; alt=&#34;图 5.2&#34; /&gt;&lt;/p&gt;

&lt;p&gt;第一层目录是本机蓝牙Mac地址，在第二层目录中找到设备管理器中记录下的设备号，点击该目录，记录右侧窗口的IRK秘钥串&lt;/p&gt;

&lt;p&gt;PS：如果有 ESP32 开发板，可以烧录&lt;a href=&#34;https://github.com/fryefryefrye/Decoding-Random-Bluetooth-Address&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Decoding-Random-Bluetooth-Address&lt;/a&gt;项目的&lt;code&gt;get_irk - esp32_irk.ino&lt;/code&gt;，再使用手机跟ESP32配对，在串口监视器中即可看到打印出来的IRK。&lt;/p&gt;

&lt;p&gt;另外，&lt;a href=&#34;https://github.com/fryefryefrye/Decoding-Random-Bluetooth-Address&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;Decoding-Random-Bluetooth-Address&lt;/a&gt;这个项目中的nrf_ble_add文件夹中，有C语实现的程序，可以用来研究随机地址与irk匹配的具体算法，我仅参考了ah函数的具体实现过程，因为项目跑起来的发现随机地址和irk的匹配结果不对。&lt;/p&gt;

&lt;h2 id=&#34;0x06-位置判断实现篇&#34;&gt;0x06 位置判断实现篇&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;## 随机地址校验器
class RandomAddressValidator(object):
    def __init__(self):
        self.irk = &#39;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;
        # 将irk的hex数值转换为字节数组
        self.key = bytearray.fromhex(self.irk)  
        self.MODE = AES.MODE_ECB

    # ah函数
    def ah(self, k, _r):
        aes = AES.new(k, self.MODE)
        encrypted_text = aes.encrypt(_r)
        return encrypted_text.hex()

    def validate(self, random_address):
        random_address = random_address.replace(&#39;:&#39;, &#39;&#39;)
        # padding用于填充prand位数
        padding = &#39;00000000000000000000000000&#39;
        # prand为随机地址的高24位
        prand = random_address[:6]
        # 用于最终校验的hash为随机地址的低24位
        hash = random_address[-6:]
        # 将填充到128位的prand转换为字节数组
        _r = bytearray.fromhex(padding + prand)
        # ah函数传入irk以及填充后的prand并返回运算结果
        ah_res = self.ah(self.key, _r)
        # 返回对比结果
        return ah_res[-6:] == hash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;校验器有了，接下来只需要循环扫描BLE信号，然后将扫描到的蓝牙地址进行一一校验，即可判断我的手机有没有在附近&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;pre_is_nearby = False
is_nearby = False
sendNotify_status = &#39;unknow&#39;

while True:
    adapters = simplepyble.Adapter.get_adapters()

    if len(adapters) == 0:
        print(&amp;quot;No adapters found&amp;quot;)

    adapter = adapters[0]

    print(f&amp;quot;Selected adapter: {adapter.identifier()} [{adapter.address()}]&amp;quot;)
    adapter.set_callback_on_scan_start(lambda: print(&amp;quot;Scan started.&amp;quot;))
    adapter.set_callback_on_scan_stop(lambda: print(&amp;quot;Scan complete.&amp;quot;))
    adapter.set_callback_on_scan_found(
        lambda peripheral: print(f&amp;quot;Found {peripheral.identifier()} [{peripheral.address()}]&amp;quot;))

    # Scan for 10 seconds
    adapter.scan_for(10000)

    peripherals = adapter.scan_get_results()

    time.sleep(1)

    pre_is_nearby = is_nearby
    is_nearby = False

    for i, peripheral in enumerate(peripherals):
        validate_res = RandomAddressValidator().validate(peripheral.address())
        print(f&amp;quot;[{peripheral.address()}] is_Matched:{validate_res}&amp;quot;)

        if validate_res:
            is_nearby = True
            break

    now_localtime = time.strftime(&amp;quot;%H:%M:%S&amp;quot;, time.localtime())

    # 上班时间
    if &amp;quot;07:00:00&amp;quot; &amp;lt; now_localtime &amp;lt; &amp;quot;08:10:00&amp;quot;:
        if is_nearby and sendNotify_status != &#39;morning&#39;:
            # 发送上班打卡提醒
            sendNotify_status = &#39;morning&#39;
    # 下班时间
    elif &amp;quot;16:59:00&amp;quot; &amp;lt; now_localtime &amp;lt; &amp;quot;20:00:00&amp;quot;:
        # 晚上会有暂时离开电脑，但并未下班的情况，需重复提醒
        if pre_is_nearby != is_nearby:
            sendNotify_status = &#39;unknow&#39;

        if not is_nearby and sendNotify_status != &#39;night&#39;:
            # 发送下班打卡提醒
            sendNotify_status = &#39;night&#39;     

    # 每30秒扫描一次
    time.sleep(30）
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;0x07-提醒方式实现篇&#34;&gt;0x07 提醒方式实现篇&lt;/h2&gt;

&lt;p&gt;我实现的提醒方式主要有两种：邮件提醒 以及 公众号通知提醒。还有一种扩展的提醒方式，是基于IOS快捷指令的自动化功能，当收到邮件时，自动弹出快捷指令提醒，该方式可以将快捷指令设置为当用户手动运行快捷指令时，自动访问确认打卡的回调网址。&lt;/p&gt;

&lt;p&gt;邮件提醒的实现非常简单，只需要在邮箱后台设置一下授权码，填入代码中即可：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# 这段代码是可以开箱即用的
def send_email(title, content):
    import smtplib
    from email.mime.multipart import MIMEMultipart
    from email.mime.text import MIMEText
    # 设置smtp host
    mail_host = &#39;smtp.163.com&#39;
    # 设置邮箱
    mail_user = &#39;XXXXXXXXXX@163.com&#39;

    # 这个是授权码 不是密码 需要去163设置
    mail_pass = &#39;XXXXXXXXXX&#39;
    sender = &#39;XXXXXXXXXX@163.com&#39;
    # 收件人邮箱
    receivers = [&#39;XXXXXXXXXX@qq.com&#39;]

    # 构造message （邮件内容）
    message = MIMEText(content, &#39;plain&#39;, &#39;utf-8&#39;)
    message[&#39;Subject&#39;] = title
    message[&#39;From&#39;] = sender
    message[&#39;To&#39;] = receivers[0]

    # smtp = smtplib.SMTP(mail_host, 587)
    try:
        # smtp = smtplib.SMTP_SSL(mail_host, 465)  # 启用SSL发信, 端口一般是465

        smtp = smtplib.SMTP()
        smtp.connect(mail_host)
        smtp.set_debuglevel(1)
        smtp.ehlo()
        # smtp.starttls()
        smtp.ehlo()
        smtp.login(mail_user, mail_pass)
        smtp.sendmail(sender, receivers, message.as_string())
        smtp.quit()
        print(&amp;quot;mail has been send successfully.&amp;quot;)
    except smtplib.SMTPException as e:
        print(e)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;公众号通知提醒，需要开通一个测试号（可以实现模板消息（业务通知）发送的功能的最简单方式），可以打开&lt;a href=&#34;https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;这里&lt;/a&gt;注册，然后配置消息模板，模板内容中字段使用&amp;rdquo;{{字段名.DATA}}&amp;ldquo;的格式进行配置，配置好之后记录下模板id，在代码层面还要做以下工作：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# access_token的数据结构
access_token = {&#39;token&#39;: None, &#39;expire_time&#39;: None}

# 检查access_token是否过期，过期则重新获取
def check_access_token(access_token_dict):
    current_time = datetime.datetime.now()
    if access_token_dict[&#39;token&#39;] is None or current_time &amp;gt; access_token_dict[&#39;expire_time&#39;]:
        token = get_access_token()
        expire_time = current_time + datetime.timedelta(seconds=7200)
        access_token_dict[&#39;token&#39;] = token
        access_token_dict[&#39;expire_time&#39;] = expire_time
    return access_token_dict

# 由于发送模板消息时需要携带access_token，token是有时间限制的，所以需要定期刷新token
def get_access_token():
    # appid和secret可以在测试号后台的“测试号信息”中获取
    url = &amp;quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;amp;appid=xxxxxxxxxx&amp;amp;secret=xxxxxxxxxx&amp;quot;

    payload = {}
    headers = {}

    response = requests.request(&amp;quot;GET&amp;quot;, url, headers=headers, data=payload)
    res = json.loads(response.text)
    print(f&amp;quot;Get access_token successfully!\n[access_token]:{res[&#39;access_token&#39;]}&amp;quot;)

    return res[&#39;access_token&#39;]

# 发送模板消息的方法，
def send_template_msg(access_token, msg_content, msg_time):
    url = &amp;quot;https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=&amp;quot; + access_token

    payload = json.dumps({
        # 接收者openid
        &amp;quot;touser&amp;quot;: &amp;quot;openid&amp;quot;,
        # 模板id
        &amp;quot;template_id&amp;quot;: &amp;quot;xxxxxxxxxx&amp;quot;,
        # 点击模板消息跳转的url
        &amp;quot;url&amp;quot;: &amp;quot;http://weixin.qq.com/download&amp;quot;,
        &amp;quot;topcolor&amp;quot;: &amp;quot;#FF0000&amp;quot;,
        &amp;quot;data&amp;quot;: {
            &amp;quot;content&amp;quot;: {
                &amp;quot;value&amp;quot;: msg_content,
                &amp;quot;color&amp;quot;: &amp;quot;#173177&amp;quot;
            },
            &amp;quot;time&amp;quot;: {
                &amp;quot;value&amp;quot;: msg_time,
                &amp;quot;color&amp;quot;: &amp;quot;#173177&amp;quot;
            }
        }
    })
    headers = {
        &#39;Content-Type&#39;: &#39;application/json&#39;
    }
    response = requests.request(&amp;quot;POST&amp;quot;, url, headers=headers, data=payload)
    print(response.text)
    return response.text
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;快捷指令提醒设置：&lt;br /&gt;
首先需要设置IOS的邮箱，我使用的是QQ邮箱，需要到QQ邮箱的设置中启用IMAP/SMTP服务，然后生成授权码。获取到授权码之后，到“邮件”中添加QQ邮箱账户，然后主机名填写imap.qq.com，用户名为QQ邮箱，密码为授权码，由于我没使用到SMTP服务，就没有进行配置。具体的配置过程可以参考&lt;a href=&#34;https://service.mail.qq.com/cgi-bin/help?subtype=1&amp;amp;&amp;amp;id=28&amp;amp;&amp;amp;no=334#5&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;QQ官方教程&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;快捷指令设置：找到快捷指令的自动化功能，具体操作很简单，就不再赘述了。&lt;/p&gt;

&lt;h2 id=&#34;0x08-花絮&#34;&gt;0x08 花絮&lt;/h2&gt;

&lt;p&gt;在Windows中使用Python实现受阻后，发现Windows SDK是提供BLE的完整支持的，于是又转过头准备在windows使用C#实现这个功能，微软还提供了若干例程，比如：&lt;a href=&#34;https://github.com/microsoft/Windows-universal-samples/tree/dev/Samples/BluetoothLE&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;BluetoothLE&lt;/a&gt;, &lt;a href=&#34;https://github.com/Microsoft/BluetoothLEExplorer&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;BluetoothLEExplorer&lt;/a&gt;有C#开发经验的朋友可以优先考虑C#实现。因为C#我太久没接触了，要重新上手开发所花费的时间成本是巨大的，就还是将工作转到寻找Win10兼容的Python BLE库了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Python 3.10.04 环境下使用 pip install pybluez 的若干报错</title>
      <link>http://blog.sinowrt.cn/2022/2022-04-30t1807-several-errors-while-installing-pybluez-with-pip-python-version-3.10.04/</link>
      <pubDate>Sat, 30 Apr 2022 18:07:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2022/2022-04-30t1807-several-errors-while-installing-pybluez-with-pip-python-version-3.10.04/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;准备在Win10使用python做蓝牙功能开发，安装了最新的Python 3.10.04，然后在Pycharm中新建工程，指定venv环境为Python 3.10.04。在使用pip安装pybluez包的时候，报了若干个Error，就写篇Blog记录一下，给大家做参考。&lt;/p&gt;

&lt;h2 id=&#34;0x01-报错及解决过程&#34;&gt;0x01 报错及解决过程&lt;/h2&gt;

&lt;p&gt;第一个报错为：&lt;code&gt;error in pybluez2 setup command: use_2to3 is invalid.&lt;/code&gt;&lt;br /&gt;
原因：高版本的&lt;code&gt;setuptools&lt;/code&gt;中不再使用&lt;code&gt;use_2to3&lt;/code&gt;
解决方法：&lt;code&gt;File &amp;gt; Settings &amp;gt; Project:xxxx &amp;gt; Python Interpreter 的Package中&lt;/code&gt; 将 &lt;code&gt;setuptools&lt;/code&gt; 版本降到58以下即可&lt;/p&gt;

&lt;p&gt;第二个报错为：&lt;code&gt;LINK : fatal error LNK1181: cannot open input file &#39;Irprops.lib&#39;&lt;/code&gt;
原因：Windows Kit中删除了irprops.lib，链接到 irprops.lib 的应用可直接改为链接到 bthprops.lib
解决方法：
根据编译命令，找到Windows Kit的位置：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt; C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Tools\MSVC\14.16.27023\bin\HostX86\x64\link.exe /nologo /INCREMENTAL:NO /LTCG /
DLL /MANIFEST:EMBED,ID=2 /MANIFESTUAC:NO /LIBPATH:E:\mcp\WorkPal\venv\libs /LIBPATH:D:\Program Files\Python\Python_310\libs /LIBPATH:D:\Program Fil
es\Python\Python_310 /LIBPATH:E:\mcp\WorkPal\venv\PCbuild\amd64 /LIBPATH:C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Tools\MS
VC\14.16.27023\lib\x64 /LIBPATH:C:\Program Files (x86)\Windows Kits\NETFXSDK\4.6.1\lib\um\x64 /LIBPATH:C:\Program Files (x86)\Windows Kits\10\lib\1
0.0.22000.0\ucrt\x64 /LIBPATH:C:\Program Files (x86)\Windows Kits\10\lib\10.0.22000.0\um\x64 WS2_32.lib Irprops.lib /EXPORT:PyInit__msbt build\temp
.win-amd64-3.10\Release\msbt\_msbt.obj /OUT:build\lib.win-amd64-3.10\bluetooth\_msbt.cp310-win_amd64.pyd /IMPLIB:build\temp.win-amd64-3.10\Release\
msbt\_msbt.cp310-win_amd64.lib
  LINK : fatal error LNK1181: cannot open input file &#39;Irprops.lib&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;根据命令，我的lib目录为&lt;code&gt;C:\Program Files (x86)\Windows Kits\10\lib\10.0.22000.0\um\x64&lt;/code&gt;&lt;br /&gt;
用管理员身份打开CMD，cd到该目录，然后使用&lt;code&gt;mklink IRPROPS.LIB bthprops.lib&lt;/code&gt;创建符号链接&lt;br /&gt;
然后重新pip install pybluez即可&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>pip install WinError 10061解决方法</title>
      <link>http://blog.sinowrt.cn/2022/2022-04-26t2103-how-to-solve-pycharm-pip-install-winerror-10061/</link>
      <pubDate>Tue, 26 Apr 2022 21:03:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2022/2022-04-26t2103-how-to-solve-pycharm-pip-install-winerror-10061/</guid>
      <description>

&lt;h2 id=&#34;0x00-解决过程&#34;&gt;0x00 解决过程&lt;/h2&gt;

&lt;p&gt;今晚在pycharm的terminal中更新pip版本的时候，遇到下面的报错：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by &#39;ProxyError(&#39;Cannot connect to proxy.&#39;, NewConnectionError(&#39;&amp;lt;pip._vendor.urllib3.connection.VerifiedHTTPSConnection object at 0x0000011051C02790&amp;gt;: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。&#39;))&#39;: /pypi/simple/pip/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;无论下载什么包都是报10061的Error。&lt;/p&gt;

&lt;p&gt;查了网上全是关系统代理呀，关浏览器代理呀，全试了一遍都没用，pycharm的代理也找了一遍都没发现问题，重启pycharm重启电脑都没用。&lt;/p&gt;

&lt;p&gt;后面还是修改注册表解决了，修改过程如下：&lt;br /&gt;
&lt;code&gt;Win+R&lt;/code&gt;键，输入regedit回车打开注册表，打开&lt;code&gt;计算机\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings&lt;/code&gt;，找到&lt;code&gt;ProxyEnable&lt;/code&gt;表项，修改数值数据为0，点击确定即可。&lt;/p&gt;

&lt;p&gt;无需重启，直接打开pycharm的terminal，可以正常更新pip了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>树莓派 ubuntu server 20.04启用蓝牙功能</title>
      <link>http://blog.sinowrt.cn/2022/2022-04-25t1936-raspberry-pi-how-to-enable-bluetooth-on-ubuntu-server-20.04/</link>
      <pubDate>Mon, 25 Apr 2022 19:36:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2022/2022-04-25t1936-raspberry-pi-how-to-enable-bluetooth-on-ubuntu-server-20.04/</guid>
      <description>

&lt;h2 id=&#34;0x00-解决过程&#34;&gt;0x00 解决过程&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;#安装bluetoothctl
sudo apt-get install pi-bluetooth

#配置设备，如果遇到配置超时，重试即可，输出Device setup complete说明配置成功
sudo hciattach /dev/ttyAMA0 bcm43xx 921600 nowflow -

#运行bluetoothctl
sudo bluetoothctl

#启动蓝牙
power on

#可被发现
discoverable on

#搜索设备
scan on

#配对
pair 设备地址

#连接
connect 设备地址

&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>在ubuntu20.04中编译OpenJDK7</title>
      <link>http://blog.sinowrt.cn/2022/2022-04-17t2030-how-to-compile-openjdk7-on-ubuntu20.04/</link>
      <pubDate>Sun, 17 Apr 2022 20:30:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2022/2022-04-17t2030-how-to-compile-openjdk7-on-ubuntu20.04/</guid>
      <description>

&lt;h2 id=&#34;0x00-编译环境&#34;&gt;0x00 编译环境&lt;/h2&gt;

&lt;p&gt;系统：ubuntu20.04&lt;br /&gt;
目标JDK：openjdk7&lt;br /&gt;
Bootstrap JDK：Java SE Development Kit 7u4&lt;br /&gt;
Ant：apache-ant-1.9.16&lt;br /&gt;
Freetype：freetype-2.3.0&lt;br /&gt;
gcc/g++版本：gcc-4.9/g++-4.9&lt;/p&gt;

&lt;h2 id=&#34;0x01-环境配置&#34;&gt;0x01 环境配置&lt;/h2&gt;

&lt;p&gt;安装依赖包&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;sudo apt-get install build-essential gawk m4 libasound2-dev libcups2-dev libxrender-dev xorg-dev xutils-dev binutils libmotif-dev
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;安装Freetype&lt;br /&gt;
将下载的软件包解压出来，进入根目录&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;./configure
sudo make
sudo make install
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;配置环境变量，可以将以下代码保存到一个文件中，使用source命令，source该文件环境变量即设置成功：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;#语言选项，这个必须设置，否则编译好后会出现一个HashTable的NPE错
export LANG=C
#Bootstrap JDK的安装路径。必须设置
export ALT_BOOTDIR=/home/sinowrt/Documents/jre1.7.0_04
#允许自动下载依赖
export ALLOW_DOWNLOADS=true
#并行编译的线程数，设置为和CPU内核数量一致即可
export HOTSPOT_BUILD_JOBS=4
export ALT_PARALLEL_COMPILE_JOBS=4
#比较本次build出来的映像与先前版本的差异。这对我们来说没有意义，
#必须设置为false，否则sanity检查会报缺少先前版本JDK的映像的错误提示。
#如果已经设置dev或者DEV_ONLY=true，这个不显式设置也行
export SKIP_COMPARE_IMAGES=true
#使用预编译头文件，不加这个编译会更慢一些
export USE_PRECOMPILED_HEADER=true
#要编译的内容
export BUILD_LANGTOOLS=true
#export BUILD_JAXP=false
#export BUILD_JAXWS=false
#export BUILD_CORBA=false
export BUILD_HOTSPOT=true
export BUILD_JDK=true
#要编译的版本
#export SKIP_DEBUG_BUILD=false
#export SKIP_FASTDEBUG_BUILD=true
#export DEBUG_NAME=debug
#把它设置为false可以避开javaws和浏览器Java插件之类的部分的build
BUILD_DEPLOY=false
#把它设置为false就不会build出安装包。因为安装包里有些奇怪的依赖，
#但即便不build出它也已经能得到完整的JDK映像，所以还是别build它好了
BUILD_INSTALL=false
#这两个环境变量必须去掉，不然会有很诡异的事情发生（我没有具体查过这些&amp;quot;诡异的
#事情&amp;quot;，Makefile脚本检查到有这2个变量就会提示警告）
unset JAVA_HOME
unset CLASSPATH

# ==============【以下是我的个性化环境配置，可以按需设置】====================
#设置freetype路径
export ALT_FREETYPE_HEADERS_PATH=/usr/local/include
export ALT_FREETYPE_LIB_PATH=/usr/local/lib
#设置Ant路径
export PATH=/home/sinowrt/Documents/apache-ant-1.9.16/bin:$PATH
#编译结果所存放的路径
export ALT_OUTPUTDIR=/home/sinowrt/Documents/jdk7u-dev/build
export ANT_HOME=/home/sinowrt/Documents/apache-ant-1.9.16
#取消Hotspot系统支持检查
export DISABLE_HOTSPOT_OS_VERSION_CHECK=false
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;0x02-编译jdk&#34;&gt;0x02 编译JDK&lt;/h2&gt;

&lt;p&gt;可以使用make sanity命令检查前面所做的设置是否正确，如果显示“Sanity check passed”即说明检查过程通过了&lt;br /&gt;
然后使用make命令进行编译，但是错了，让我们看看报错信息：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;g++ -DLINUX -D_GNU_SOURCE -DAMD64 -DPRODUCT -I. -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/prims -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/cpu/x86/vm -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os_cpu/linux_x86/vm -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/posix/vm -I../generated -DHOTSPOT_RELEASE_VERSION=&amp;quot;\&amp;quot;24.80-b07\&amp;quot;&amp;quot; -DHOTSPOT_BUILD_TARGET=&amp;quot;\&amp;quot;product\&amp;quot;&amp;quot; -DHOTSPOT_BUILD_USER=&amp;quot;\&amp;quot;sinowrt\&amp;quot;&amp;quot; -DHOTSPOT_LIB_ARCH=\&amp;quot;amd64\&amp;quot; -DHOTSPOT_VM_DISTRO=&amp;quot;\&amp;quot;OpenJDK\&amp;quot;&amp;quot; -DTARGET_OS_FAMILY_linux -DTARGET_ARCH_x86 -DTARGET_ARCH_MODEL_x86_64 -DTARGET_OS_ARCH_linux_x86 -DTARGET_OS_ARCH_MODEL_linux_x86_64 -DTARGET_COMPILER_gcc -DCOMPILER2 -DCOMPILER1 -fPIC -fno-rtti -fno-exceptions -D_REENTRANT -fcheck-new -fvisibility=hidden -m64 -pipe -O3 -fno-strict-aliasing -g -DVM_LITTLE_ENDIAN -D_LP64=1 -fno-omit-frame-pointer -DINCLUDE_TRACE=1 -Werror -Wpointer-arith -Wsign-compare    -c -fpch-deps -MMD -MP -MF ../generated/dependencies/precompiled.hpp.gch.d -x c++-header /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp -o precompiled.hpp.gch 
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/sharedHeap.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/gc_implementation/parallelScavenge/psParallelCompact.hpp:34,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/gc_implementation/shared/markSweep.inline.hpp:32,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/oop.inline.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/classFileParser.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/classLoader.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/systemDictionary.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciEnv.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciUtilities.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciNullObject.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciConstant.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:36:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/generation.hpp:422:17: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  422 |         warning(&amp;quot;time warp: &amp;quot;INT64_FORMAT&amp;quot; to &amp;quot;INT64_FORMAT, _time_of_last_gc, now);
      |                 ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/generation.hpp:422:42: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  422 |         warning(&amp;quot;time warp: &amp;quot;INT64_FORMAT&amp;quot; to &amp;quot;INT64_FORMAT, _time_of_last_gc, now);
      |                                          ^
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/gc_interface/collectedHeap.inline.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/oop.inline.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/classFileParser.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/classLoader.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/systemDictionary.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciEnv.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciUtilities.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciNullObject.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciConstant.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:36:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/threadLocalAllocBuffer.inline.hpp:97:25: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   97 |     gclog_or_tty-&amp;gt;print(&amp;quot;TLAB: %s thread: &amp;quot;INTPTR_FORMAT&amp;quot; [id: %2d]&amp;quot;
      |                         ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/threadLocalAllocBuffer.inline.hpp:98:25: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   98 |                         &amp;quot; obj: &amp;quot;SIZE_FORMAT
      |                         ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/threadLocalAllocBuffer.inline.hpp:99:25: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   99 |                         &amp;quot; free: &amp;quot;SIZE_FORMAT
      |                         ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/threadLocalAllocBuffer.inline.hpp💯25: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  100 |                         &amp;quot; waste: &amp;quot;SIZE_FORMAT&amp;quot;\n&amp;quot;,
      |                         ^
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/space.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/space.inline.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/gc_implementation/shared/cSpaceCounters.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/defNewGeneration.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/services/memoryPool.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/services/lowMemoryDetector.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/gc_interface/collectedHeap.inline.hpp:36,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/oop.inline.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/classFileParser.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/classLoader.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/systemDictionary.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciEnv.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciUtilities.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciNullObject.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciConstant.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:36:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/cardTableModRefBS.hpp:156:20: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  156 |            err_msg(&amp;quot;Attempt to access p = &amp;quot;PTR_FORMAT&amp;quot; out of bounds of &amp;quot;
      |                    ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/cardTableModRefBS.hpp:157:20: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  157 |                    &amp;quot; card marking array&#39;s _whole_heap = [&amp;quot;PTR_FORMAT&amp;quot;,&amp;quot;PTR_FORMAT&amp;quot;)&amp;quot;,
      |                    ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/cardTableModRefBS.hpp:157:69: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  157 |                    &amp;quot; card marking array&#39;s _whole_heap = [&amp;quot;PTR_FORMAT&amp;quot;,&amp;quot;PTR_FORMAT&amp;quot;)&amp;quot;,
      |                                                                     ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/cardTableModRefBS.hpp:432:20: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  432 |            err_msg(&amp;quot;Returning result = &amp;quot;PTR_FORMAT&amp;quot; out of bounds of &amp;quot;
      |                    ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/cardTableModRefBS.hpp:433:20: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  433 |                    &amp;quot; card marking array&#39;s _whole_heap = [&amp;quot;PTR_FORMAT&amp;quot;,&amp;quot;PTR_FORMAT&amp;quot;)&amp;quot;,
      |                    ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/cardTableModRefBS.hpp:433:69: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  433 |                    &amp;quot; card marking array&#39;s _whole_heap = [&amp;quot;PTR_FORMAT&amp;quot;,&amp;quot;PTR_FORMAT&amp;quot;)&amp;quot;,
      |                                                                     ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/cardTableModRefBS.hpp:441:20: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  441 |            err_msg(&amp;quot;Attempt to access p = &amp;quot;PTR_FORMAT&amp;quot; out of bounds of &amp;quot;
      |                    ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/cardTableModRefBS.hpp:442:20: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  442 |                    &amp;quot; card marking array&#39;s _whole_heap = [&amp;quot;PTR_FORMAT&amp;quot;,&amp;quot;PTR_FORMAT&amp;quot;)&amp;quot;,
      |                    ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/cardTableModRefBS.hpp:442:69: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
  442 |                    &amp;quot; card marking array&#39;s _whole_heap = [&amp;quot;PTR_FORMAT&amp;quot;,&amp;quot;PTR_FORMAT&amp;quot;)&amp;quot;,
      |                                                                     ^
In file included from ../generated/tracefiles/traceEventClasses.hpp:18,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/trace/tracing.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/opto/compile.hpp:44,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/opto/node.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/opto/addnode.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:259:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/trace/traceStream.hpp:44:15: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   44 |     _st.print(&amp;quot;%s = &amp;quot;UINT32_FORMAT, label, val);
      |               ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/trace/traceStream.hpp:48:15: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   48 |     _st.print(&amp;quot;%s = &amp;quot;UINT32_FORMAT, label, val);
      |               ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/trace/traceStream.hpp:52:15: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   52 |     _st.print(&amp;quot;%s = &amp;quot;INT32_FORMAT, label, val);
      |               ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/trace/traceStream.hpp:56:15: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   56 |     _st.print(&amp;quot;%s = &amp;quot;UINT32_FORMAT, label, val);
      |               ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/trace/traceStream.hpp:60:15: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   60 |     _st.print(&amp;quot;%s = &amp;quot;INT32_FORMAT, label, val);
      |               ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/trace/traceStream.hpp:64:15: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   64 |     _st.print(&amp;quot;%s = &amp;quot;UINT64_FORMAT, label, val);
      |               ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/trace/traceStream.hpp:68:15: error: invalid suffix on literal; C++11 requires a space between literal and string macro [-Werror=literal-suffix]
   68 |     _st.print(&amp;quot;%s = &amp;quot;INT64_FORMAT, label, val);
      |               ^
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:29:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/code/relocInfo.hpp:374:27: error: friend declaration of &#39;relocInfo prefix_relocInfo(int)&#39; specifies default arguments and isn&#39;t a definition [-fpermissive]
  374 |   inline friend relocInfo prefix_relocInfo(int datalen = 0);
      |                           ^~~~~~~~~~~~~~~~
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:29:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/code/relocInfo.hpp:469:18: error: friend declaration of &#39;relocInfo prefix_relocInfo(int)&#39; specifies default arguments and isn&#39;t the only declaration [-fpermissive]
  469 | inline relocInfo prefix_relocInfo(int datalen) {
      |                  ^~~~~~~~~~~~~~~~
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:29:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/code/relocInfo.hpp:374:27: note: previous declaration of &#39;relocInfo prefix_relocInfo(int)&#39;
  374 |   inline friend relocInfo prefix_relocInfo(int datalen = 0);
      |                           ^~~~~~~~~~~~~~~~
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/compiler/disassembler.hpp:31,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.inline.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:30:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/os_linux.inline.hpp: In static member function &#39;static dirent* os::readdir(DIR*, dirent*)&#39;:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/os_linux.inline.hpp:154:18: error: &#39;int readdir_r(DIR*, dirent*, dirent**)&#39; is deprecated [-Werror=deprecated-declarations]
  154 |   if((status = ::readdir_r(dirp, dbuf, &amp;amp;p)) != 0) {
      |                  ^~~~~~~~~
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/jvm_linux.h:44,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/prims/jvm.h:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/utilities/debug.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/runtime/globals.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/allocation.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/iterator.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/genOopClosures.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/klass.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/runtime/handles.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/code/oopRecorder.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:29:
/usr/include/dirent.h:183:12: note: declared here
  183 | extern int readdir_r (DIR *__restrict __dirp,
      |            ^~~~~~~~~
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/compiler/disassembler.hpp:31,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.inline.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:30:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/os_linux.inline.hpp:154:42: error: &#39;int readdir_r(DIR*, dirent*, dirent**)&#39; is deprecated [-Werror=deprecated-declarations]
  154 |   if((status = ::readdir_r(dirp, dbuf, &amp;amp;p)) != 0) {
      |                                          ^
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/jvm_linux.h:44,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/prims/jvm.h:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/utilities/debug.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/runtime/globals.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/allocation.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/iterator.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/genOopClosures.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/klass.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/runtime/handles.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/code/oopRecorder.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:29:
/usr/include/dirent.h:183:12: note: declared here
  183 | extern int readdir_r (DIR *__restrict __dirp,
      |            ^~~~~~~~~
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/compiler/disassembler.hpp:31,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.inline.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:30:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/os_linux.inline.hpp:154:42: error: &#39;int readdir_r(DIR*, dirent*, dirent**)&#39; is deprecated [-Werror=deprecated-declarations]
  154 |   if((status = ::readdir_r(dirp, dbuf, &amp;amp;p)) != 0) {
      |                                          ^
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/jvm_linux.h:44,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/prims/jvm.h:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/utilities/debug.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/runtime/globals.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/allocation.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/iterator.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/genOopClosures.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/klass.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/runtime/handles.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/code/oopRecorder.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:29:
/usr/include/dirent.h:183:12: note: declared here
  183 | extern int readdir_r (DIR *__restrict __dirp,
      |            ^~~~~~~~~
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/constantPoolOop.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/methodOop.hpp:33,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/runtime/frame.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/prims/jvmtiExport.hpp:33,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/runtime/thread.hpp:32,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/thread_linux.inline.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/memory/resourceArea.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/classFileParser.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/classLoader.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/classfile/systemDictionary.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciEnv.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciUtilities.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciNullObject.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciConstant.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:36:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/cpCacheOop.hpp: At global scope:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/cpCacheOop.hpp:189:42: error: left operand of shift expression &#39;(-1 &amp;lt;&amp;lt; 28)&#39; is negative [-fpermissive]
  189 |     option_bits_mask           = ~(((-1) &amp;lt;&amp;lt; tos_state_shift) | (field_index_mask | parameter_size_mask))
      |                                    ~~~~~~^~~~~~~~~~~~~~~~~~~
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/oops/cpCacheOop.hpp:189:104: error: enumerator value for &#39;option_bits_mask&#39; is not an integer constant
  189 |     option_bits_mask           = ~(((-1) &amp;lt;&amp;lt; tos_state_shift) | (field_index_mask | parameter_size_mask))
      |                                                                                                        ^
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciEnv.hpp:32,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciUtilities.hpp:28,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciNullObject.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/ci/ciConstant.hpp:29,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:36:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/code/dependencies.hpp:169:59: error: left operand of shift expression &#39;(-1 &amp;lt;&amp;lt; 1)&#39; is negative [-fpermissive]
  169 |     all_types           = ((1 &amp;lt;&amp;lt; TYPE_LIMIT) - 1) &amp;amp; ((-1) &amp;lt;&amp;lt; FIRST_TYPE),
      |                                                     ~~~~~~^~~~~~~~~~~~~~
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/code/dependencies.hpp:169:72: error: enumerator value for &#39;all_types&#39; is not an integer constant
  169 |     all_types           = ((1 &amp;lt;&amp;lt; TYPE_LIMIT) - 1) &amp;amp; ((-1) &amp;lt;&amp;lt; FIRST_TYPE),
      |                                                                        ^
cc1plus: all warnings being treated as errors
make[6]: *** [/home/sinowrt/Documents/jdk7u-dev/hotspot/make/linux/makefiles/vm.make:296: precompiled.hpp.gch] Error 1
make[6]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/build/hotspot/outputdir/linux_amd64_compiler2/product&#39;
make[5]: *** [/home/sinowrt/Documents/jdk7u-dev/hotspot/make/linux/makefiles/top.make:119: the_vm] Error 2
make[5]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/build/hotspot/outputdir/linux_amd64_compiler2/product&#39;
make[4]: *** [/home/sinowrt/Documents/jdk7u-dev/hotspot/make/linux/Makefile:290: product] Error 2
make[4]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/build/hotspot/outputdir&#39;
make[3]: *** [Makefile:192: generic_build2] Error 2
make[3]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/hotspot/make&#39;
make[2]: *** [Makefile:151: product] Error 2
make[2]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/hotspot/make&#39;
make[1]: *** [make/hotspot-rules.gmk:114: hotspot-build] Error 2
make[1]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev&#39;
make: *** [Makefile:251: build_product_image] Error 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个问题是因为安装依赖包时，默认安装了高版本的gcc和g++，可使用&lt;code&gt;gcc -v&lt;/code&gt;或&lt;code&gt;g++ -v&lt;/code&gt;命令查看版本，需要安装低版本的gcc/g++&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;sinowrt@ubuntu:~/Documents/jdk7u-dev$ gcc -v
#省略若干行...
gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.1)

sinowrt@ubuntu:~/Documents/jdk7u-dev$ g++ -v      
#省略若干行...
gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.1)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;我选择安装4.9版本的gcc与g++&lt;br /&gt;
而ubuntu20.04中&lt;code&gt;sudo apt-get install gcc-4.9&lt;/code&gt;会提示找不到安装包，需要添加低版本的源，这里我添加的是ubuntu16的aliyun源&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;sudo vi /etc/apt/source.list

#在文件最后面添加源信息,`:wq`保存退出
#源===========================【Start】=============================
deb http://mirrors.aliyun.com/ubuntu/ xenial main
deb-src http://mirrors.aliyun.com/ubuntu/ xenial main

deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main

deb http://mirrors.aliyun.com/ubuntu/ xenial universe
deb-src http://mirrors.aliyun.com/ubuntu/ xenial universe
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates universe

deb http://mirrors.aliyun.com/ubuntu/ xenial-security main
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main
deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security universe
#源===========================【E n d】=============================

#更新源
sudo apt-get update
#安装gcc-4.9 g++-4.9
sudo apt-get install gcc-4.9 g++-4.9

sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 40
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 50
sudo update-alternatives --config gcc

#sinowrt@ubuntu:~/Documents/jdk7u-dev$ sudo update-alternatives --config gcc
#There are 2 choices for the alternative gcc (providing /usr/bin/gcc)
#
#  Selection    Path              Priority   Status
#------------------------------------------------------------
#* 0            /usr/bin/gcc-9     50        auto mode
#  1            /usr/bin/gcc-4.9   40        manual mode
#  2            /usr/bin/gcc-9     50        manual mode
#Press &amp;lt;enter&amp;gt; to keep the current choice[*], or type selection number: 

#根据提示，输入数字1，选择当前使用的gcc为gcc-4.9
#g++的配置也一样，此处略
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;切换到低版本的gcc和g++后，make clean重新make，虽然还是会报error，但是只是warning输出为error，如下面输出所示&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;g++ -DLINUX -D_GNU_SOURCE -DAMD64 -DPRODUCT -I. -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/prims -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/cpu/x86/vm -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os_cpu/linux_x86/vm -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm -I/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/posix/vm -I../generated -DHOTSPOT_RELEASE_VERSION=&amp;quot;\&amp;quot;24.80-b07\&amp;quot;&amp;quot; -DHOTSPOT_BUILD_TARGET=&amp;quot;\&amp;quot;product\&amp;quot;&amp;quot; -DHOTSPOT_BUILD_USER=&amp;quot;\&amp;quot;sinowrt\&amp;quot;&amp;quot; -DHOTSPOT_LIB_ARCH=\&amp;quot;amd64\&amp;quot; -DHOTSPOT_VM_DISTRO=&amp;quot;\&amp;quot;OpenJDK\&amp;quot;&amp;quot; -DTARGET_OS_FAMILY_linux -DTARGET_ARCH_x86 -DTARGET_ARCH_MODEL_x86_64 -DTARGET_OS_ARCH_linux_x86 -DTARGET_OS_ARCH_MODEL_linux_x86_64 -DTARGET_COMPILER_gcc -DCOMPILER2 -DCOMPILER1 -fPIC -fno-rtti -fno-exceptions -D_REENTRANT -fcheck-new -fvisibility=hidden -m64 -pipe -O3 -fno-strict-aliasing -g -DVM_LITTLE_ENDIAN -D_LP64=1 -fno-omit-frame-pointer -DINCLUDE_TRACE=1 -Werror -Wpointer-arith -Wsign-compare    -c -fpch-deps -MMD -MP -MF ../generated/dependencies/precompiled.hpp.gch.d -x c++-header /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp -o precompiled.hpp.gch 
In file included from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/compiler/disassembler.hpp:31:0,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/asm/assembler.inline.hpp:30,
                 from /home/sinowrt/Documents/jdk7u-dev/hotspot/src/share/vm/precompiled/precompiled.hpp:30:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/os_linux.inline.hpp: In static member function &#39;static dirent* os::readdir(DIR*, dirent*)&#39;:
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/os_linux.inline.hpp:154:18: error: &#39;int readdir_r(DIR*, dirent*, dirent**)&#39; is deprecated (declared at /usr/include/dirent.h:183) [-Werror=deprecated-declarations]
   if((status = ::readdir_r(dirp, dbuf, &amp;amp;p)) != 0) {
                  ^
/home/sinowrt/Documents/jdk7u-dev/hotspot/src/os/linux/vm/os_linux.inline.hpp:154:42: error: &#39;int readdir_r(DIR*, dirent*, dirent**)&#39; is deprecated (declared at /usr/include/dirent.h:183) [-Werror=deprecated-declarations]
   if((status = ::readdir_r(dirp, dbuf, &amp;amp;p)) != 0) {
                                          ^
cc1plus: all warnings being treated as errors
make[6]: *** [/home/sinowrt/Documents/jdk7u-dev/hotspot/make/linux/makefiles/vm.make:296: precompiled.hpp.gch] Error 1
make[6]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/build/hotspot/outputdir/linux_amd64_compiler2/product&#39;
make[5]: *** [/home/sinowrt/Documents/jdk7u-dev/hotspot/make/linux/makefiles/top.make:119: the_vm] Error 2
make[5]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/build/hotspot/outputdir/linux_amd64_compiler2/product&#39;
make[4]: *** [/home/sinowrt/Documents/jdk7u-dev/hotspot/make/linux/Makefile:290: product] Error 2
make[4]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/build/hotspot/outputdir&#39;
make[3]: *** [Makefile:192: generic_build2] Error 2
make[3]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/hotspot/make&#39;
make[2]: *** [Makefile:151: product] Error 2
make[2]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev/hotspot/make&#39;
make[1]: *** [make/hotspot-rules.gmk:114: hotspot-build] Error 2
make[1]: Leaving directory &#39;/home/sinowrt/Documents/jdk7u-dev&#39;
make: *** [Makefile:251: build_product_image] Error 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;出现这些错误是因为编译的时候，添加了-Werror参数，只要将-Werror参数去掉即可&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;vi hotspot/make/linux/makefiles/gcc.make
#找到WARNINGS_ARE_ERRORS = -Werror整行注释掉
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;:wq&lt;/code&gt;保存退出之后，&lt;code&gt;make clean&lt;/code&gt;再重新&lt;code&gt;make&lt;/code&gt;即可成功编译，整个编译过程有点久，耐心等待即可。&lt;br /&gt;
编译成功会出现如下提示：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;########################################################################
##### Leaving jdk for target(s) sanity all docs images             #####
########################################################################
##### Build time 00:05:21 jdk for target(s) sanity all docs images #####
########################################################################

#-- Build times ----------
Target all_product_build
Start 2022-04-19 06:55:27
End   2022-04-19 07:05:10
00:00:59 corba
00:02:51 hotspot
00:00:08 jaxp
00:00:10 jaxws
00:05:21 jdk
00:00:14 langtools
00:09:43 TOTAL
-------------------------
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;0x03-总结&#34;&gt;0x03 总结&lt;/h2&gt;

&lt;p&gt;Ubuntu相对于Mac和Win平台，编译JDK更容易，之前也在MacOS中尝试过编译JDK7，由于Command Line Tools与新版本macOS不兼容而以失败告终，在Ubuntu中软件包的安装更宽松，使得编译环境更容易配置，建议老版本的JDK优先考虑使用Ubuntu进行编译。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>如何在Ubuntu20.04中安装VMware tools</title>
      <link>http://blog.sinowrt.cn/2022/2022-04-17t2024-how-to-install-vmware-tools-on-ubuntu20.04/</link>
      <pubDate>Sun, 17 Apr 2022 20:24:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2022/2022-04-17t2024-how-to-install-vmware-tools-on-ubuntu20.04/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;在vmware中装了Ubuntu 20.04之后，要实现虚拟机和宿主机之间的文件或字符串拷贝，必须安装vmware tools。&lt;/p&gt;

&lt;h2 id=&#34;0x01-安装过程&#34;&gt;0x01 安装过程&lt;/h2&gt;

&lt;p&gt;sudo apt-get update
sudo apt-get install open-vm-tools-desktop -y
sudo reboot&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>修复echart数据不显示的问题————暨解决tomcat默认编码导致后端接收urlencode参数乱码的问题</title>
      <link>http://blog.sinowrt.cn/2022/2022-04-01t1431-decode-issue-while-deployed-with-tomcat/</link>
      <pubDate>Fri, 01 Apr 2022 14:31:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2022/2022-04-01t1431-decode-issue-while-deployed-with-tomcat/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;最近收到一个开发任务，虽然是新系统，但是技术架构非常老，是使用tomcat进行部署的（这句话要记好，后面会考的）。
这个系统原本外包团队已经开发好了，在公司测试环境中跑起来的时候，echart却不加载，那么我就来看看是什么问题。&lt;/p&gt;

&lt;h2 id=&#34;0x01-过程一&#34;&gt;0x01 过程一&lt;/h2&gt;

&lt;p&gt;首先是将项目基本环境搭建起来，因为我的移动电脑访问不到公司内网数据库，在这里还用Goproxy搭建了一个代理服务，移动电脑通过代理服务间接连到数据库。
项目跑起来之后，通过console调试大法，发现后端是有返回数据的，但是到了echart中却显示不出来。&lt;br /&gt;
既然这样，那就console.log一下echart，看看里面的data是啥，有没有跟后端返回的结果匹配起来。
结果发现后端返回的是广东省或者广西壮族自治区等全称，但是前端的data中就只显示各个省份的简称：广东、广西等。&lt;br /&gt;
既然数据集有了，也比较固定，那么就在前端建立一个映射字典，将后端返回的值进行简称映射替换之后，就可以正常匹配上了。&lt;br /&gt;
这里还有另一个办法，就是在echart的option中新增一个nameMap，将映射关系加上，也能正常匹配，但是由于映射名称之后，各省份的名称比较长，有些重叠有些错位，于是就不适用在option中添加nameMap的方法。&lt;br /&gt;
在经过上面的处理之后，地图中的数据也能正常显示了。&lt;/p&gt;

&lt;h2 id=&#34;0x01-过程二&#34;&gt;0x01 过程二&lt;/h2&gt;

&lt;p&gt;除了过程一中的地图显示问题之外，在该地图下方还有一个对应点击对应省份，放大该省可以显示各区域的数据的功能。首先是地图也默认加载不出来，经排查之后，确认是url拼接有问题，更正之后就可以发送数据请求了，但是请求返回的是无数据。
又经过一番仔细排查，确认是查询省份的时候，传到后端的是“广东”，而非全称“广东省”，这个好办，还是跟上面一样，加一个映射表，在发送请求的时候，将查询参数通过映射表映射为全称即可查到数据。&lt;br /&gt;
加了映射表之后，发现还是查不到！看了后端的日志，发现参数是乱码，我想了下，之前我也调整了tomcat的日志显示编码，也添加了-Dfile参数，日志显示这一块应该是没问题了。那么就只有前端发送请求时没有指定编码或者后端解析参数的时候跟前端编码不一致的问题了，于是在前端指定了content-type的encoding参数，但是发现还是乱码。在后端的requestmapping中指定解码编码也不行。&lt;br /&gt;
好家伙，实在没辙了，那就复制乱码，随便百度一个乱码查询的网站，发现原字符编码是UTF-8，解析编码是iso8859-1的时候，是能够还原回“广东省”的，于是线索又回到了tomcat。&lt;br /&gt;
查了一下资料，发现问题就是出现在tomcat上，如果在server.xml中未指定解析编码的话，tomcat默认编码就是iso-8859-1。&lt;br /&gt;
原因找到了，咱打开tomcat根目录下的conf文件夹，找到server.xml文件，将connector指定编码&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;Connector  port=&amp;quot;8080&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot; connectionTimeout=&amp;quot;20000&amp;quot; redirectPort=&amp;quot;8443&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;修改为：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;Connector useBodyEncodingForURI=&amp;quot;true&amp;quot; URIEncoding=&amp;quot;UTF-8&amp;quot;
            port=&amp;quot;8080&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot;
            connectionTimeout=&amp;quot;20000&amp;quot;
            redirectPort=&amp;quot;8443&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;之后，重启tomcat即可。&lt;/p&gt;

&lt;h2 id=&#34;0x01-过程三&#34;&gt;0x01 过程三&lt;/h2&gt;

&lt;p&gt;虽然解决了前端传值到后端的乱码问题，但是后面我发现，后端传回浏览器的开发人员工具中的值竟然也显示乱码。&lt;br /&gt;
这又是咋回事呢？
仔细看了一下，发现是后端返回的时候，response中的header并未携带编码信息，浏览器无法识别到编码，就使用默认的windows-1252进行解析，就产生了乱码的问题，虽然传到前端是正常的，但是为了方便后面上线之后的调试，还是到后端指定了Content-Type的header，指定之后，就正常啦。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>在windows server 2019中部署git服务端</title>
      <link>http://blog.sinowrt.cn/2022/2022-03-28t2024-deploy-a-git-service-on-windows/</link>
      <pubDate>Mon, 28 Mar 2022 20:24:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2022/2022-03-28t2024-deploy-a-git-service-on-windows/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;最近公司有些文件需要共享，协同编辑，建一个共享文件夹吧，又太糙了，如果能够记录下文件的修改记录就更好了，于是我想到了搭建一个git私服，开干。&lt;/p&gt;

&lt;h2 id=&#34;0x01-环境介绍&#34;&gt;0x01 环境介绍&lt;/h2&gt;

&lt;p&gt;系统环境：windows server 2019&lt;br /&gt;
软件包：&lt;a href=&#34;https://dl.gogs.io/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;gogs&lt;/a&gt;、&lt;a href=&#34;https://git-scm.com/download/win&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;git for windows&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;0x02-部署过程&#34;&gt;0x02 部署过程&lt;/h2&gt;

&lt;p&gt;先安装git for windows，我这里下载的是安装版，傻瓜式安装即可。&lt;/p&gt;

&lt;p&gt;将下载的gogs压缩包解压出来，cmd进入根目录，直接运行./gogs web&lt;/p&gt;

&lt;p&gt;gogs默认是监听了本地3000端口，打开浏览器打开&lt;code&gt;http://localhost:3000/install&lt;/code&gt;进行初始化配置&lt;/p&gt;

&lt;p&gt;配置挺简单的，特别说一下设置数据库类型（选SQLite3即可，选其他数据库需要另外安装），其他按需设置即可&lt;/p&gt;

&lt;p&gt;配置完成之后打开&lt;code&gt;http://localhost:3000/&lt;/code&gt;即可进入gogs的web界面&lt;/p&gt;

&lt;p&gt;如果需要开放到外网，在防火墙放行端口即可。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>使用socks5代理绕过防火墙安全策略</title>
      <link>http://blog.sinowrt.cn/2022/2022-03-27t2231-bypass-firewall-security-policies-using-a-proxy/</link>
      <pubDate>Sun, 27 Mar 2022 22:31:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2022/2022-03-27t2231-bypass-firewall-security-policies-using-a-proxy/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;公司不让使用向日葵远程了，在防火墙屏蔽了向日葵，原本可以使用frp穿透的，奈何防病毒软件又太给力了，刚下载下来就被强制删掉，关又关不掉，并且公司电脑是win10家庭版，阉割了远程桌面功能，这个方案就直接pass掉了。由于手头上有空闲的vps，于是转而想到搭建socks5代理服务器，再配置向日葵使用代理连接外网就好了。&lt;/p&gt;

&lt;h2 id=&#34;0x01-前期准备&#34;&gt;0x01 前期准备&lt;/h2&gt;

&lt;p&gt;1.国内VPS一台（保证网络更好更稳定）&lt;br /&gt;
2.&lt;a href=&#34;https://github.com/snail007/goproxy&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;goproxy&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;0x02-服务端搭建&#34;&gt;0x02 服务端搭建&lt;/h2&gt;

&lt;p&gt;根据系统平台下载对应版本的goproxy，我下载的是windwos版本的，下载后解压进入软件根目录，根据说明文档，运行命令&lt;code&gt;proxy socks -t tcp -p &amp;quot;0.0.0.0:38080&amp;quot; -g &amp;quot;公网地址&amp;quot;--udp-port 0 --udp&lt;/code&gt;，启动服务。（记得放行防火墙端口）&lt;/p&gt;

&lt;h2 id=&#34;0x03-向日葵连接代理服务器&#34;&gt;0x03 向日葵连接代理服务器&lt;/h2&gt;

&lt;p&gt;打开向日葵网络设置，配置代理地址及端口，测试提示连接成功即可保存。&lt;/p&gt;

&lt;h2 id=&#34;0x04-总结&#34;&gt;0x04 总结&lt;/h2&gt;

&lt;p&gt;至此，整个代理配置已经完成了，过程难点主要在寻找合适的代理软件，在github上面搜搜star多的项目保证没错。（ps：goproxy太好用了，还跨平台，强推！）&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>在树莓派（ARM）上面运行hpool的chia挖矿程序（AMD64）</title>
      <link>http://blog.sinowrt.cn/2021/2021-04-23t1847-how-to-run-chia-miner-of-hpool-on-raspberry-pi4/</link>
      <pubDate>Fri, 23 Apr 2021 18:47:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-04-23t1847-how-to-run-chia-miner-of-hpool-on-raspberry-pi4/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;最近chia挖矿可太火了，可惜我运气太差，一个币都没挖到，算了还是直接加入矿池吧。可是硬盘容量已经p完了，用台式机挂机的话，怕是电费都不够亏吧。&lt;br /&gt;
之前在chia的wiki上面，我看到了一个用Rock PI4b组装的矿机，很是心动。可惜Rock pi的生态比Raspberry pi逊色很多，而我又不使用官方软件进行耕种，到时各种适配起来可是个麻烦事。所以，在对比之下我还是选择了Raspberry Pi4B。&lt;/p&gt;

&lt;h2 id=&#34;0x01-硬件准备&#34;&gt;0x01 硬件准备&lt;/h2&gt;

&lt;h3 id=&#34;1-一块树莓派raspberry-pi4b&#34;&gt;1. 一块树莓派Raspberry Pi4B&lt;/h3&gt;

&lt;h3 id=&#34;2-sata转usb3-0的易驱线-带12v供电端口的-我选择的是绿巨能的-便宜好用&#34;&gt;2. sata转usb3.0的易驱线（带12v供电端口的）我选择的是绿巨能的，便宜好用&lt;/h3&gt;

&lt;h3 id=&#34;3-atx电源一个-根据你硬盘的数量来选择功率-我这里用的是家里闲置的200w-长城电源&#34;&gt;3. ATX电源一个（根据你硬盘的数量来选择功率）我这里用的是家里闲置的200W 长城电源&lt;/h3&gt;

&lt;h3 id=&#34;4-大4pin接口转3-5mm-12v-dc接口-转接线若干条&#34;&gt;4. 大4Pin接口转3.5mm 12V DC接口 转接线若干条&lt;/h3&gt;

&lt;h2 id=&#34;0x02-兜兜转转-仅记录过程-解决方案可以直接看下一节&#34;&gt;0x02 兜兜转转（仅记录过程 解决方案可以直接看下一节）&lt;/h2&gt;

&lt;p&gt;将可执行文件上传到树莓派上面，直接运行的时候 会提示&lt;code&gt;Exec Format Error&lt;/code&gt;，因为树莓派是ARM架构的，而可执行文件是AMD64架构的。&lt;br /&gt;
可执行文件的信息可以使用&lt;code&gt;file 可执行文件&lt;/code&gt;查看，如hpool-miner-chia这个可执行文件的信息就是：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;ubuntu@ubuntu:~/linux$ file ./hpool-miner-chia 
./hpool-miner-chia: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, Go BuildID=or4EJC7edY1jm53BAfGR/s_m3PpAuyo9gsjpS3x4h/Eg54hBo5Pfw4tHBF5qZ0/g1_NAK8AbL3R_FIeKSr6, stripped
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;也可以使用readelf命令查看，如&lt;code&gt;readelf -h python&lt;/code&gt;，得到的是ELF Header中的项Magic，第五个数 02时为64位，01时为32位。&lt;/p&gt;

&lt;h3 id=&#34;1-box86方案&#34;&gt;1. box86方案&lt;/h3&gt;

&lt;p&gt;第一次尝试是在raspberry os上面安装box86，但是运行的时候发现box86并不支持64位可执行文件，遂作罢。&lt;/p&gt;

&lt;h3 id=&#34;2-exagear方案&#34;&gt;2. exagear方案&lt;/h3&gt;

&lt;p&gt;这个方案并未尝试，因为exagear 跟box86一样，只支持32位的可执行文件。&lt;/p&gt;

&lt;h3 id=&#34;3-qemu方案&#34;&gt;3. qemu方案&lt;/h3&gt;

&lt;p&gt;使用&lt;code&gt;sudo apt-get install qemu-user&lt;/code&gt;命令安装qemu-user，这个命令会自动安装qemu-user和binfmt，binfmt会通过判断可执行文件的类型，自动选择是否通过qemu来执行该文件。&lt;/p&gt;

&lt;p&gt;这个方案虽然是可行的，但是探索的过程也是十分曲折：&lt;/p&gt;

&lt;p&gt;环境: 32位raspios + qemu-user + hpool-miner-chia v1.0.5&lt;br /&gt;
启动的时候提示：dlopen err: Dynamic loading not supported&lt;br /&gt;
然后就是不认plot文件，报open fail 和 Invalid file的错误，但是连接矿池正常，只是没认到plot文件，没有算力，hpool上面也不显示矿机在线。&lt;/p&gt;

&lt;p&gt;环境: 32位raspios + qemu-user + hpool-miner-chia v1.0.4.1&lt;br /&gt;
启动的时候不提示dlopen err: Dynamic loading not supported了&lt;br /&gt;
但仍然不认plot文件，报open fail 和 Invalid file的错误，但是连接矿池正常，只是没认到plot文件，没有算力，hpool上面也不显示矿机在线。&lt;/p&gt;

&lt;p&gt;环境: 64位raspios + qemu-user + hpool-miner-chia v1.0.4.1&lt;br /&gt;
启动的时候提示&lt;code&gt;qemu: uncaught target signal 11 (Segmentation fault) - core dumped&lt;/code&gt; 直接罢工了&lt;/p&gt;

&lt;p&gt;在28号下午，hpool 发布了 1.1.0 版本的 hpool-miner-chia，由于官方说下一个版本会支持arm，但是实测并没有，没有就没有吧，试一下能不能用qemu运行&lt;/p&gt;

&lt;p&gt;环境: 32位raspios + qemu-user + hpool-miner-chia v1.1.0&lt;br /&gt;
启动的时候不提示dlopen err: Dynamic loading not supported了&lt;br /&gt;
但仍然不认plot文件，报open fail 和 Invalid file的错误，但是连接矿池正常，只是没认到plot文件，没有算力，hpool上面也不显示矿机在线。&lt;/p&gt;

&lt;h2 id=&#34;0x04-最终方案&#34;&gt;0x04 最终方案&lt;/h2&gt;

&lt;p&gt;我曾一度想着是不是 usb3.0转sata 转接线坏了，就在虚拟机上面开了ubuntu，连上了硬盘，运行一切正常。&lt;/p&gt;

&lt;p&gt;那么问题应该就是出在树莓派上面了，由于之前下载了ubuntu arm64的系统，但是那晚上挂着测试树莓派稳定性的时候，把TF卡烧了，就没有用过这个ubuntu系统。然后我就想，会不会跟系统有关呢，试了那么多个版本的可执行文件都是一个结果。于是拆下TF卡，烧录ubuntu arm64的系统，挂硬盘&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;# 查看待挂载设备列表
sudo fdisk -l

# 挂载硬盘 我在这里是将/dev/sda1挂载到当前目录的ploted文件夹 
sudo mount /dev/sda1 ./ploted

# 解除挂载
sudo umount /dev/sda1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;硬盘挂载好后，把hpool-miner-chia v1.1.0 版本的执行文件上传上去，&lt;code&gt;sudo apt-get install qemu-user&lt;/code&gt;安装qemu-user。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;qemu-x86_64 ./hpool-miner-chia&lt;/code&gt;运行。竟然好了！！&lt;/p&gt;

&lt;p&gt;虽然不报错，也能认plot文件了，但是挂了一晚上测试发现，这个软件会自己退出。&lt;/p&gt;

&lt;p&gt;这好办，上supervisor就好了，具体步骤请参考&lt;a href=&#34;https://blog.sinowrt.cn/2020/2020-04-12t2330-ubuntuadd-ngrok-to-supervisor/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;这篇博客&lt;/a&gt;自行配置。&lt;/p&gt;

&lt;p&gt;最后附上ubuntu的版本: ubuntu-20.04.2-preinstalled-server-arm64+raspi.img.xz&lt;/p&gt;

&lt;p&gt;聪明的彦祖们应该知道怎么下载的。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>如何将群晖的软件包和资料转移到另一个硬盘</title>
      <link>http://blog.sinowrt.cn/2021/2021-04-22t1330-how-to-move-the-package-and-documents-in-synology-to-another-hard-disk/</link>
      <pubDate>Thu, 22 Apr 2021 13:30:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-04-22t1330-how-to-move-the-package-and-documents-in-synology-to-another-hard-disk/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;最近网上刮起了chia风，由于手上也有大容量硬盘，但是挂在群晖上做存储盘，于是想将这个盘腾出来，将资料转移到另一个硬盘中。&lt;/p&gt;

&lt;h2 id=&#34;0x01-过程&#34;&gt;0x01 过程&lt;/h2&gt;

&lt;h3 id=&#34;1-添加新硬盘&#34;&gt;1. 添加新硬盘&lt;/h3&gt;

&lt;p&gt;首先需要准备一个完全擦除的硬盘，将群晖关机后，将该硬盘接入群晖。启动群晖之后，打开Storage Manager新建一个raid group（我原来是用单盘建立的basic raid group），建立好后再新建一个Volume，如果勾选了全盘扫描的话，需要等待一段时间才能建好。&lt;/p&gt;

&lt;h3 id=&#34;2-转移资料&#34;&gt;2. 转移资料&lt;/h3&gt;

&lt;p&gt;资料的转移比较简单，打开Control Panel - Shared Folder，选择需要转移的共享文件夹，点击Edit，再Location下拉框中选择新建的Volume即可自动转移。&lt;/p&gt;

&lt;h3 id=&#34;3-转移package&#34;&gt;3. 转移package&lt;/h3&gt;

&lt;p&gt;转移package需要用到一个软件MODS Package Manager，我在&lt;a href=&#34;https://www.beatificabytes.be/sspks&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;https://www.beatificabytes.be/sspks&lt;/a&gt; 上面下载下来，再在Package Center中手动上传安装的。&lt;br /&gt;
在打开Package Manager的时候遇到白屏的问题，原因是该软件的一个JS需要从谷歌下载，打开fq软件代理一下即可解决。（如果没有fq条件的话，也可以参照&lt;a href=&#34;https://blog.csdn.net/qq_17311873/article/details/109536316&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;这篇博客&lt;/a&gt; 改成国内可以访问的cdn即可解决）
软件的使用很简单，选择需要移动的package，然后选择目标Volume，点击Move Package即可。
有些软件在转移过程中会失败，套件没有移动成功，可以不用管它。打开Package Center，会提示该套件错误无法运行，这时候点击修复即可完成套件的转移了。&lt;/p&gt;

&lt;h3 id=&#34;4-转移moments里面的照片&#34;&gt;4. 转移Moments里面的照片&lt;/h3&gt;

&lt;p&gt;Moments的照片是存在/homes 共享目录中的，所以只要将该共享目录按步骤2进行转移即可，这一步也可以在Control Panel - User - User Home - Location的下拉框选择转移到新卷。需要特别注意的是Drive的数据库的转移，打开Drive Admin Console - Settings - Database Location 选择转移到目标卷中即可。（在群晖的官网中又说到，在Storage Manager安全地移除Volume也可以转移数据库，但我选择稳妥一点，手动转移）&lt;/p&gt;

&lt;h3 id=&#34;5-安全移除卷&#34;&gt;5. 安全移除卷&lt;/h3&gt;

&lt;p&gt;最后一步，我是直接关机，将旧盘直接摘下，然后开机看看有没有什么异常，确保数据都安全地转移到了新卷。&lt;br /&gt;
最后再将旧盘装上，在Storage Manager中安全地移除卷，将旧盘取下来。&lt;/p&gt;

&lt;h2 id=&#34;0x02-遇到的问题&#34;&gt;0x02 遇到的问题&lt;/h2&gt;

&lt;p&gt;在转移资料的第4步中，我没有转移Drive的数据库，直接摘下了硬盘，并启动了群晖，在package center上面修复了Drive 和 Moments，导致Moments不可用。&lt;br /&gt;
最后还是将旧盘装上，在Drive Admin Console中转移了数据库，然后将Moments套件连同数据库一起删除，再重装才解决了问题。
这样的话，就丢失了之前Moments索引的信息，没关系直接再索引一遍就好了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>用python下载七牛云的图片并批量重命名</title>
      <link>http://blog.sinowrt.cn/2021/2021-03-10t1451-using-python-to-download-pictures-from-qiniu-and-batch-rename/</link>
      <pubDate>Wed, 10 Mar 2021 14:51:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-03-10t1451-using-python-to-download-pictures-from-qiniu-and-batch-rename/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;最近想要搭建一个对象存储服务，并把原本在七牛云上面的图片全部转移到该服务中管理，但是七牛云上面的图片命名本来就很乱，不符合批量管理的要求，所以不能从七牛云直接下载，而是要把图片名格式化一下，再下载下来，这种工作，用python是最适合不过了，于是就有了这篇文章。&lt;/p&gt;

&lt;h2 id=&#34;0x01-过程&#34;&gt;0x01 过程&lt;/h2&gt;

&lt;h3 id=&#34;1-命名规则转换&#34;&gt;1. 命名规则转换&lt;/h3&gt;

&lt;p&gt;原本图片的命名是&lt;code&gt;images/1979-01-01T0000/1.png&lt;/code&gt;这样的格式，现在要统一放在一个文件夹，所以需要去掉images文件夹，并把时间和图片名通过&amp;rdquo;-&amp;ldquo;拼接起来。&lt;/p&gt;

&lt;h3 id=&#34;2-将七牛云上面的文件名及其对应的url列表导出&#34;&gt;2. 将七牛云上面的文件名及其对应的url列表导出&lt;/h3&gt;

&lt;p&gt;这一步可以直接在七牛云上面批量操作，导出的文件是是csv格式的，所以在python中可以使用csv库直接进行读取&lt;/p&gt;

&lt;h3 id=&#34;3-编写代码&#34;&gt;3. 编写代码&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;import requests
import csv

def download_img(img_url, api_token, name):
    print (img_url)
    header = {&amp;quot;Authorization&amp;quot;: &amp;quot;Bearer &amp;quot; + api_token} # 设置http header，视情况加需要的条目，这里的token是用来鉴权的一种方式
    r = requests.get(img_url, headers=header, stream=True)
    print(r.status_code) # 返回状态码
    if r.status_code == 200:
        open(&#39;C:\\Users\\Jacky\\Pictures\\blogpic\\&#39; + name, &#39;wb&#39;).write(r.content) # 将内容写入图片
        print(&amp;quot;done&amp;quot;)
    del r

if __name__ == &#39;__main__&#39;:
    api_token = &amp;quot;apitoken&amp;quot;

    record = csv.reader(open(&#39;urls&#39;, &#39;r&#39;, encoding=&#39;utf-8-sig&#39;))
    for i in record:
        name = i[0]
        # 改名
        name = name[7:].replace(&#39;/&#39;, &#39;-&#39;)
        # 提取图片链接
        url = i[1]
        download_img(url, api_token, name)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;0x02-总结&#34;&gt;0x02 总结&lt;/h2&gt;

&lt;p&gt;非常简单，就封装一个请求函数，然后读取csv文件里面的字段，给图片重命名并把url传入请求函数，把图片下载到指定目录。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>用docker安装minio对象存储服务</title>
      <link>http://blog.sinowrt.cn/2021/2021-03-09t2224-how-to-install-minio-with-docker/</link>
      <pubDate>Tue, 09 Mar 2021 22:24:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-03-09t2224-how-to-install-minio-with-docker/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;博客里面的图片之前使用的是七牛云的对象存储，用http协议传输的，自chrome更新之后就出现了强制跳转https的问题，而用新版edge还是可以打开的，但是今天我突然发现edge也不好使了，都会强制跳转https。而七牛云里面的https是收费的，既然我有服务器，有域名那就物尽其用搭一个对象存储服务吧。&lt;/p&gt;

&lt;h2 id=&#34;0x01-过程&#34;&gt;0x01 过程&lt;/h2&gt;

&lt;p&gt;由于我的机器之前已经安装了docker，docker的安装过程就不赘述了，咱们直接从minio安装说起。&lt;/p&gt;

&lt;h3 id=&#34;1-首先把minio的镜像拉下来&#34;&gt;1. 首先把minio的镜像拉下来&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;docker pull minio/minio&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;2-创建docker-compose-yml文件-写入以下内容&#34;&gt;2. 创建docker-compose.yml文件,写入以下内容&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;version: &#39;3.1&#39;
services: 
    minio:
      image: minio/minio
      container_name: minio
      restart: always
      ports:
        - 9000:9000
      command: server /data  #指定容器中的目录 /data
      environment:
        MINIO_ACCESS_KEY: minio    #管理后台用户名
        MINIO_SECRET_KEY: minioxxx #管理后台密码，最小8个字符
      volumes:
        - ./data:/data              #映射当前目录下的data目录至容器内/data目录
        - ./config:/root/.minio/     #映射配置目录
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;3-配置证书&#34;&gt;3. 配置证书&lt;/h3&gt;

&lt;p&gt;在腾讯云上面申请了免费的证书，解压后将Apache中的xx.crt和xx.key文件分别改名为public.crt和private.key后放到minio的config/cert文件夹中。&lt;/p&gt;

&lt;h3 id=&#34;4-以deamon模式启动minio服务&#34;&gt;4. 以deamon模式启动minio服务&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;docker-compose up -d&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;5-配置访问策略&#34;&gt;5. 配置访问策略&lt;/h3&gt;

&lt;p&gt;网页登录minio，然后新建一个bucket，点击新建的bucket右边三个点，点击Edit policy，prefix填入*，由于该bucket是用作博客的图床的，所以策略选择read only，最后点击Add即可。&lt;/p&gt;

&lt;h2 id=&#34;0x02-遇到的问题&#34;&gt;0x02 遇到的问题&lt;/h2&gt;

&lt;h3 id=&#34;1-浏览器提示err-cert-common-name-invalid错误&#34;&gt;1. 浏览器提示ERR_CERT_COMMON_NAME_INVALID错误&lt;/h3&gt;

&lt;p&gt;这个错误是因为当时没有添加域名解析，直接使用了ip加端口访问，与证书里面的域名不匹配而提示的不安全连接问题。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>为什么挂载在docker容器中的配置文件在宿主机中修改后却没生效</title>
      <link>http://blog.sinowrt.cn/2021/2021-03-09t1530-why-configuration-file-mounted-in-docker-has-no-effect-after-modified-in-host/</link>
      <pubDate>Tue, 09 Mar 2021 15:30:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-03-09t1530-why-configuration-file-mounted-in-docker-has-no-effect-after-modified-in-host/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;我想在服务器中使用nginx对不同子域名的网页进行分流，于是编辑nginx的配置文件，由于该配置文件从docker里面映射出来了，所以我就只在宿主机里面使用vim修改了配置文件，然后让容器执行命令&lt;code&gt;docker exec -it containerID nginx -s reload&lt;/code&gt;，但是似乎没有生效，于是就有了这篇文章。&lt;/p&gt;

&lt;h2 id=&#34;0x01-过程&#34;&gt;0x01 过程&lt;/h2&gt;

&lt;p&gt;使用命令进入容器里面查看，配置文件没有竟然还是之前的，没有被修改。于是，上去搜索了一下，发现这里面还真有坑。&lt;/p&gt;

&lt;h3 id=&#34;问题原因&#34;&gt;问题原因：&lt;/h3&gt;

&lt;p&gt;docker挂载文件时，并不是挂载了某个文件的路径，而是挂载了对应的文件，即挂载了linux指定的inode文件。&lt;br /&gt;
当使用vim之类的编辑器进行保存时，它不是直接保存文件，而是采用了备份、替换的策略，就是编辑时，是创建一个新的文件，在保存的时候，把备份文件替换源文件，这个时候文件的 inode 就发生了变化，而原来 inode 对应的文件其实并没有修改，也就是容器内的文件没有变化。当重启容器的时候，会挂载新的 inode。&lt;/p&gt;

&lt;h2 id=&#34;0x02-总结&#34;&gt;0x02 总结&lt;/h2&gt;

&lt;p&gt;在docker中应该尽量挂载目录，避免挂载文件。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>如何解决cannot run bzip2: No such file or directory错误</title>
      <link>http://blog.sinowrt.cn/2021/2021-03-09t0930-cannot-run-bzip2-no-such-file-or-directory/</link>
      <pubDate>Tue, 09 Mar 2021 09:30:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-03-09t0930-cannot-run-bzip2-no-such-file-or-directory/</guid>
      <description>

&lt;h2 id=&#34;0x00-错误描述&#34;&gt;0x00 错误描述&lt;/h2&gt;

&lt;p&gt;今天在使用tar解压文件的时候，报了一个错
&lt;code&gt;cannot run bzip2: No such file or directory&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;0x01-解决方法&#34;&gt;0x01 解决方法&lt;/h2&gt;

&lt;p&gt;这个错误是因为系统中缺少bzip2，使用yum安装上就好了
&lt;code&gt;yum -y install bzip2&lt;/code&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>