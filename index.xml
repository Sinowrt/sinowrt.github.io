<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Sinowrt on Sinowrt</title>
    <link>http://blog.sinowrt.cn/</link>
    <description>Recent content in Sinowrt on Sinowrt</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 09 Mar 2021 22:24:00 +0800</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>用docker安装minio对象存储服务</title>
      <link>http://blog.sinowrt.cn/2021/2021-03-09t2224-how-to-install-minio-with-docker/</link>
      <pubDate>Tue, 09 Mar 2021 22:24:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-03-09t2224-how-to-install-minio-with-docker/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;博客里面的图片之前使用的是七牛云的对象存储，用http协议传输的，自chrome更新之后就出现了强制跳转https的问题，而用新版edge还是可以打开的，但是今天我突然发现edge也不好使了，都会强制跳转https。而七牛云里面的https是收费的，既然我有服务器，有域名那就物尽其用搭一个对象存储服务吧。&lt;/p&gt;

&lt;h2 id=&#34;0x01-过程&#34;&gt;0x01 过程&lt;/h2&gt;

&lt;p&gt;由于我的机器之前已经安装了docker，docker的安装过程就不赘述了，咱们直接从minio安装说起。&lt;/p&gt;

&lt;h3 id=&#34;1-首先把minio的镜像拉下来&#34;&gt;1. 首先把minio的镜像拉下来&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;docker pull minio/minio&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;2-创建docker-compose-yml文件-写入以下内容&#34;&gt;2. 创建docker-compose.yml文件,写入以下内容&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;version: &#39;3.1&#39;
services: 
    minio:
      image: minio/minio
      container_name: minio
      restart: always
      ports:
        - 9000:9000
      command: server /data  #指定容器中的目录 /data
      environment:
        MINIO_ACCESS_KEY: minio    #管理后台用户名
        MINIO_SECRET_KEY: minioxxx #管理后台密码，最小8个字符
      volumes:
        - ./data:/data              #映射当前目录下的data目录至容器内/data目录
        - ./config:/root/.minio/     #映射配置目录
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;3-配置证书&#34;&gt;3. 配置证书&lt;/h3&gt;

&lt;p&gt;在腾讯云上面申请了免费的证书，解压后将Apache中的xx.crt和xx.key文件分别改名为public.crt和private.key后放到minio的config/cert文件夹中。&lt;/p&gt;

&lt;h3 id=&#34;4-以deamon模式启动minio服务&#34;&gt;4. 以deamon模式启动minio服务&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;docker-compose up -d&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;5-配置访问策略&#34;&gt;5. 配置访问策略&lt;/h3&gt;

&lt;p&gt;网页登录minio，然后新建一个bucket，点击新建的bucket右边三个点，点击Edit policy，prefix填入*，由于该bucket是用作博客的图床的，所以策略选择read only，最后点击Add即可。&lt;/p&gt;

&lt;h2 id=&#34;0x02-遇到的问题&#34;&gt;0x02 遇到的问题&lt;/h2&gt;

&lt;h3 id=&#34;1-浏览器提示err-cert-common-name-invalid错误&#34;&gt;1. 浏览器提示ERR_CERT_COMMON_NAME_INVALID错误&lt;/h3&gt;

&lt;p&gt;这个错误是因为当时没有添加域名解析，直接使用了ip加端口访问，与证书里面的域名不匹配而提示的不安全连接问题。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>failed to handler mux client connection 错误</title>
      <link>http://blog.sinowrt.cn/2021/2021-03-05t1347-failed-to-handler-mux-client-connection/</link>
      <pubDate>Fri, 05 Mar 2021 13:47:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-03-05t1347-failed-to-handler-mux-client-connection/</guid>
      <description>

&lt;h2 id=&#34;0x00-错误描述&#34;&gt;0x00 错误描述&lt;/h2&gt;

&lt;p&gt;使用v2rayN连接节点的时候，总是会出现这个警告：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2021/03/05 13:45:52 [Warning] failed to handler mux client connection &amp;gt; v2ray.com/core/proxy/vmess/outbound: connection ends &amp;gt; v2ray.com/core/proxy/vmess/outbound: failed to read header &amp;gt; v2ray.com/core/proxy/vmess/encoding: failed to read response header &amp;gt; websocket: close 1000 (normal)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;上网查了一圈，发现是节点时间与客户端时间不一致导致的。&lt;/p&gt;

&lt;h2 id=&#34;0x01-解决方案&#34;&gt;0x01 解决方案&lt;/h2&gt;

&lt;p&gt;节点是基于ubuntu搭建的，所以下面将给出ubuntu设置时区的教程：&lt;/p&gt;

&lt;h3 id=&#34;1-运行-tzselect-选择-asia-china-beijing&#34;&gt;1. 运行&lt;code&gt;tzselect&lt;/code&gt;,选择 Asia -&amp;gt; China -&amp;gt; Beijing。&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;root@KnobbyKindhearted-VM:~/v2ray-poseidon/docker/sspanel/ws-tls# tzselect
Please identify a location so that time zone rules can be set correctly.
Please select a continent, ocean, &amp;quot;coord&amp;quot;, or &amp;quot;TZ&amp;quot;.
 1) Africa
 2) Americas
 3) Antarctica
 4) Asia
 5) Atlantic Ocean
 6) Australia
 7) Europe
 8) Indian Ocean
 9) Pacific Ocean
10) coord - I want to use geographical coordinates.
11) TZ - I want to specify the time zone using the Posix TZ format.
#? 4
Please select a country whose clocks agree with yours.
 1) Afghanistan       18) Israel            35) Palestine
 2) Armenia       19) Japan         36) Philippines
 3) Azerbaijan        20) Jordan            37) Qatar
 4) Bahrain       21) Kazakhstan        38) Russia
 5) Bangladesh        22) Korea (North)     39) Saudi Arabia
 6) Bhutan        23) Korea (South)     40) Singapore
 7) Brunei        24) Kuwait            41) Sri Lanka
 8) Cambodia          25) Kyrgyzstan        42) Syria
 9) China         26) Laos          43) Taiwan
10) Cyprus        27) Lebanon           44) Tajikistan
11) East Timor        28) Macau         45) Thailand
12) Georgia       29) Malaysia          46) Turkmenistan
13) Hong Kong         30) Mongolia          47) United Arab Emirates
14) India         31) Myanmar (Burma)       48) Uzbekistan
15) Indonesia         32) Nepal         49) Vietnam
16) Iran          33) Oman          50) Yemen
17) Iraq          34) Pakistan
#? 9
Please select one of the following time zone regions.
1) Beijing Time
2) Xinjiang Time
#? 1

The following information has been given:

    China
    Beijing Time

Therefore TZ=&#39;Asia/Shanghai&#39; will be used.
Local time is now:  Fri Mar  5 13:46:27 CST 2021.
Universal Time is now:  Fri Mar  5 05:46:27 UTC 2021.
Is the above information OK?
1) Yes
2) No
#? 1

You can make this change permanent for yourself by appending the line
    TZ=&#39;Asia/Shanghai&#39;; export TZ
to the file &#39;.profile&#39; in your home directory; then log out and log in again.

Here is that TZ value again, this time on standard output so that you
can use the /usr/bin/tzselect command in shell scripts:
Asia/Shanghai
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;2-复制文件到-etc目录下-cp-usr-share-zoneinfo-asia-shanghai-etc-localtime&#34;&gt;2. 复制文件到/etc目录下&lt;code&gt;cp /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime&lt;/code&gt;&lt;/h3&gt;
</description>
    </item>
    
    <item>
      <title>sspanel 与 v2ray-poseidon 环境下如何搭建一个中转节点</title>
      <link>http://blog.sinowrt.cn/2021/2021-03-05t1556-how-to-create-a-transit-node-base-on-sspanel-and-v2ray-poseidon/</link>
      <pubDate>Fri, 05 Mar 2021 13:47:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-03-05t1556-how-to-create-a-transit-node-base-on-sspanel-and-v2ray-poseidon/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;前两天搭建了个sspanel,后端主要使用v2ray-poseidon。之前没用面板的时候，一直是使用中转节点，安装nginx来反代节点，nginx 反代节点的教程前天也发出来了，大家有兴趣也可以看看。但是那篇文章只写道了如何反代节点，而没有提到如何将这种方式与sspanle搭配使用。&lt;/p&gt;

&lt;p&gt;之前使用nginx反代节点的过程中，在sspanel遇到的问题主要是：在sspanel新建这个中转节点后，面板中总是显示灰色不可用状态，尽管将配置导入v2ray客户端是可用的。&lt;/p&gt;

&lt;p&gt;这个问题困扰了我很久，今天突然就想通了，造成这个问题的主要原因是：面板的节点ID与这个落地节点的ID不匹配，因为落地节点也作为一个独立的节点导入到了面板中，而节点ID又是自增的无法重复设置，所以就会产生这样的问题。&lt;/p&gt;

&lt;h2 id=&#34;0x01-解决过程&#34;&gt;0x01 解决过程&lt;/h2&gt;

&lt;p&gt;今天突然发现poseidon的教程中，有服务端多开v2ray的教程，于是我想，那我在这个节点开多一个v2ray实例就行啦！&lt;/p&gt;

&lt;h3 id=&#34;1-使用docker多开v2ray实例用于中转节点连接&#34;&gt;1. 使用docker多开v2ray实例用于中转节点连接&lt;/h3&gt;

&lt;p&gt;1）复制目录&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;cd /root/v2ray-poseidon/docker/sspanel
cp -a ws-tls ws-tls-2
cd ws-tls-2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2）修改config.json&lt;br /&gt;
配置nodeId为面板中新建的中转节点ID，然后将acceptProxyProtocol 选项值改为 true。&lt;/p&gt;

&lt;p&gt;3） 修改docker-compose.yml&lt;br /&gt;
container_name:v2ray-ws-tls-2
ports 下面的端口改成其它端口，不然会和原 v2ray-poseidon 出现端口冲突&lt;/p&gt;

&lt;p&gt;4） 启动&lt;br /&gt;
&lt;code&gt;dc up -d&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;2-中转节点配置&#34;&gt;2. 中转节点配置&lt;/h3&gt;

&lt;p&gt;1）安装 HAProxy&lt;br /&gt;
&lt;code&gt;yum -y install haproxy&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;2）修改HAProxy 配置文件&lt;br /&gt;
清空默认配置&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;echo &#39;&#39; &amp;gt; /etc/haproxy/haproxy.cfg
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;举例，现在我有个中转分配的端口为 20001，需要转发 v2ray.poseidon-gfw.cc&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;frontend sg1_frontend
  bind *:20001
  default_backend sg1_server

backend sg1_server
  server s1 sg1-test-trojanp.poseidon-gfw.cc:443 send-proxy
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果需要中转多个落地机，可以复制上面的内容，比如&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# 这是第一个
frontend sg1_frontend
  bind *:20001
  default_backend sg1_server

backend sg1_server
  server s1 sg1-test-trojanp.poseidon-gfw.cc:443 send-proxy

# 这里是第二个
frontend jp1_frontend(这个是可以随便改的，每个中转端口一个名字，别重就行)
  bind *:20002
  default_backend jp1_server(这里必须为落地的名字， backend 后面的内容)

backend jp1_server(此处为落地的名字，可以随便改，每个落地一个名字，别重就行)
  server s1 jp1-test-trojanp.poseidon-gfw.cc:443 send-proxy

# ... ... 还可以有更多
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;3）重启 HAProxy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;systemctl restart haproxy
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;3-sspanel面板配置&#34;&gt;3. sspanel面板配置&lt;/h3&gt;

&lt;p&gt;由于我是ws + tls，所以面板中的节点地址配置如下：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;落地机器ip或域名;落地机器端口;alterid;tls;ws;path=/|server=中转机器ip或域名|outside_port=中转机器端口
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;下面给出其他方案的节点地址配置：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;// TCP 示例，请注意后面有两个分号
非CDN域名或者ip;非0;2;tcp;;

// WS
非CDN域名或者ip;8080;2;ws;;path=/v2ray|host=这里可以用加了CDN的域名

// WS + TLS (自动配置）
非CDN域名或者ip;非0;2;tls;ws;path=/v2ray|host=tls的域名|inside_port=10550

// WS + TLS (Caddy 提供)
非CDN域名或者ip;0;2;tls;ws;path=/v2ray|host=tls的域名|inside_port=10550|outside_port=443


// nat鸡 ws
非CDN域名或者ip;非0;2;ws;;path=/v2ray|host=这里可以用加了CDN的域名

// nat鸡 ws + tls (自动配置)，因为部分商家并不提供 80 &amp;amp; 443 访问，所以请考虑手动申请 SSL 证书
非CDN域名或者ip;非0;2;tls;ws;path=/v2ray|host=tls的域名

// nat鸡 ws + tls (Caddy 提供)，因为部分商家并不提供 80 &amp;amp; 443 访问，所以请考虑手动申请 SSL 证书
非CDN域名或者ip;0;2;tls;ws;path=/v2ray|host=tls的域名|inside_port=10550|outside_port=11120


// 以下为 KCP 示例部分，支持所有 V2Ray 的 type：

// none: 默认值，不进行伪装，发送的数据是没有特征的数据包。
非CDN域名或者ip;非0;2;kcp;noop;

// srtp: 伪装成 SRTP 数据包，会被识别为视频通话数据（如 FaceTime）。
非CDN域名或者ip;非0;2;kcp;srtp;

// utp: 伪装成 uTP 数据包，会被识别为 BT 下载数据。
非CDN域名或者ip;非0;2;kcp;utp;

// wechat-video: 伪装成微信视频通话的数据包。
非CDN域名或者ip;非0;2;kcp;wechat-video;

// dtls: 伪装成 DTLS 1.2 数据包。
非CDN域名或者ip;非0;2;kcp;dtls;

// wireguard: 伪装成 WireGuard 数据包(并不是真正的 WireGuard 协议) 。
非CDN域名或者ip;非0;2;kcp;wireguard;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;0x02-结语&#34;&gt;0x02 结语&lt;/h2&gt;

&lt;p&gt;至此，sspanel的中转节点配置就完成了，其中HAProxy换成nginx的效果应该是一样的，我还没尝试，有兴趣的朋友可以试一下。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>docker-compose 启动报错 read time out</title>
      <link>http://blog.sinowrt.cn/2021/2021-03-04t2218-http-timeout-while-starting-docker-compose/</link>
      <pubDate>Thu, 04 Mar 2021 15:53:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-03-04t2218-http-timeout-while-starting-docker-compose/</guid>
      <description>

&lt;h2 id=&#34;0x00-现象&#34;&gt;0x00 现象&lt;/h2&gt;

&lt;p&gt;今晚在三毛中安装docker版的v2节点，在用docker-compose启动过程中，报了read time out 的错误，如下：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@ruvds-4ytfy ws-tls]# dc up -d
Creating network &amp;quot;ws-tls_default&amp;quot; with the default driver
Pulling v2ray-ws-tls (v2cc/poseidon:)...
latest: Pulling from v2cc/poseidon
ba3557a56b15: Pull complete
d2371de70a8e: Pull complete
e93b600e94e9: Pull complete
Digest: sha256:627405b203b97a91d285dee998dbc8e4503b2dbe7e6fc7d1a788c81e2782f986
Status: Downloaded newer image for v2cc/poseidon:latest
Creating v2ray-ws-tls ... 

ERROR: for v2ray-ws-tls  UnixHTTPConnectionPool(host=&#39;localhost&#39;, port=None): Read timed out. (read timeout=60)

ERROR: for v2ray-ws-tls  UnixHTTPConnectionPool(host=&#39;localhost&#39;, port=None): Read timed out. (read timeout=60)
ERROR: An HTTP request took too long to complete. Retry with --verbose to obtain debug information.
If you encounter this issue regularly because of slow network conditions, consider setting COMPOSE_HTTP_TIMEOUT to a higher value (current value: 60).
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;0x01-解决方法&#34;&gt;0x01 解决方法&lt;/h2&gt;

&lt;p&gt;在docker-compose.yml的文件夹中，新建一个.env文件，新建一行：&lt;code&gt;COMPOSE_HTTP_TIMEOUT=1000&lt;/code&gt;，然后wq。&lt;br /&gt;
接着&lt;code&gt;docker down&lt;/code&gt;，再&lt;code&gt;docker up -d&lt;/code&gt;。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>使用Nginx代理ws&#43;tls的V2ray节点</title>
      <link>http://blog.sinowrt.cn/2021/2021-03-03t1903-using-nginx-to-proxy-tls-ws-v2ray-node/</link>
      <pubDate>Wed, 03 Mar 2021 19:07:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-03-03t1903-using-nginx-to-proxy-tls-ws-v2ray-node/</guid>
      <description>

&lt;h2 id=&#34;0x00-背景&#34;&gt;0x00 背景&lt;/h2&gt;

&lt;p&gt;这两天给v2节点配上了ws+tls，但是直连的话速度还是不太理想，于是想用另一个vps中转一下，就有了这篇文章。&lt;/p&gt;

&lt;h2 id=&#34;0x01-过程&#34;&gt;0x01 过程&lt;/h2&gt;

&lt;p&gt;虽然之前也用nginx中转过v2流量，但是从没中转过使用tls的节点，都是普通的使用ws节点而已。于是上网查了很多资料，都说直接配置nginx的证书，然后v2节点就取消tls就好了，但是我又希望有时能直连一下这个节点，如果不配置tls的话，感觉又不是很放心。所以还是坚持继续探索，终于也让我找到了。&lt;/p&gt;

&lt;h2 id=&#34;0x02-解决方案&#34;&gt;0x02 解决方案&lt;/h2&gt;

&lt;p&gt;在nginx这段我没有配置ssl，所以不用配置证书啥的，就直接给出nginx的配置吧：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;server {
        listen 中转节点监听端口;
        server_name 中转节点域名;

        location / {
            proxy_pass http://后端IP或域名:后端监听端口/wspath;  # 若后端开启tls，则需要写https://
            
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection &amp;quot;upgrade&amp;quot;;
        }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;0x03-补充说明&#34;&gt;0x03 补充说明&lt;/h2&gt;

&lt;p&gt;之前的迷糊是在于不清楚tls的工作过程，以为中转后客户端也是直接与服务端进行tls握手的，其实真实的情况是，客户端是与nginx直接连接的，而nginx才是与v2服务端握手的一方。也就是说，客户端与nginx的连接 和 nginx与v2服务端的连接是不同的两端连接，两个不同的连接均可自由配置tls。&lt;/p&gt;

&lt;h2 id=&#34;0x04-一些错误&#34;&gt;0x04 一些错误&lt;/h2&gt;

&lt;h3 id=&#34;1-nginx没配置ssl-但是v2客户端配置了tls连接造成的错误&#34;&gt;1.nginx没配置ssl，但是v2客户端配置了tls连接造成的错误&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;[Warning] failed to handler mux client connection &amp;gt; v2ray.com/core/proxy/vmess/outbound: failed to find an available destination &amp;gt; v2ray.com/core/common/retry: [v2ray.com/core/transport/internet/websocket: failed to dial WebSocket &amp;gt; v2ray.com/core/transport/internet/websocket: failed to dial to (wss://HOST:PORT/):  &amp;gt; tls: first record does not look like a TLS handshake] &amp;gt; v2ray.com/core/common/retry: all retry attempts failed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方案：&lt;br /&gt;
将v2客户端的tls连接去掉即可。&lt;/p&gt;

&lt;h3 id=&#34;2-客户端保留了-伪装域名-也就是host字段保留了cdn的域名造成的错误&#34;&gt;2.客户端保留了“伪装域名”也就是host字段保留了cdn的域名造成的错误&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;[Warning] failed to handler mux client connection &amp;gt; v2ray.com/core/proxy/vmess/outbound: failed to find an available destination &amp;gt; v2ray.com/core/common/retry: [v2ray.com/core/transport/internet/websocket: failed to dial WebSocket &amp;gt; v2ray.com/core/transport/internet/websocket: failed to dial to (ws://HOST:PORT/): 404 Not Found &amp;gt; websocket: bad handshake] &amp;gt; v2ray.com/core/common/retry: all retry attempts failed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方案：&lt;br /&gt;
将客户端中的host字段清空去掉就好了。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Vi 的一些基本操作</title>
      <link>http://blog.sinowrt.cn/2021/2021-02-26t1740-basic-operation-in-vi/</link>
      <pubDate>Fri, 26 Feb 2021 17:40:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-02-26t1740-basic-operation-in-vi/</guid>
      <description>

&lt;h2 id=&#34;0x00-基本操作&#34;&gt;0x00 基本操作&lt;/h2&gt;

&lt;h3 id=&#34;1-查找&#34;&gt;1.查找&lt;/h3&gt;

&lt;p&gt;命令模式下，\ + 关键字&lt;/p&gt;

&lt;h3 id=&#34;2-显示行号&#34;&gt;2.显示行号&lt;/h3&gt;

&lt;p&gt;命令模式下, :set number&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>《深入理解JVM》之别在MacOS编译OpenJDK7</title>
      <link>http://blog.sinowrt.cn/2021/2021-02-26t1633-compile-a-jvm-on-macos/</link>
      <pubDate>Fri, 26 Feb 2021 16:33:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2021/2021-02-26t1633-compile-a-jvm-on-macos/</guid>
      <description>

&lt;h2 id=&#34;0x00-前言&#34;&gt;0x00 前言&lt;/h2&gt;

&lt;p&gt;《深入理解JVM》这本书都看了大半了，但是里面的实验还没真正动手操作过，于是趁这段时间一一操作一遍。&lt;/p&gt;

&lt;p&gt;首当其冲的当然是编译JVM了，似乎所有的坑都被我都趟了一遍，就写篇文来记录一下，顺便告诫大家，不要试图在新版本的macOS中编译OpenJDK7！&lt;/p&gt;

&lt;h2 id=&#34;0x01-编译环境&#34;&gt;0x01 编译环境&lt;/h2&gt;

&lt;p&gt;macOS Catalina 10.15.2&lt;br /&gt;
Xcode 11.6&lt;br /&gt;
Command Line Tools MacOSX10.15.sdk&lt;/p&gt;

&lt;h2 id=&#34;0x02-准备工作&#34;&gt;0x02 准备工作&lt;/h2&gt;

&lt;h3 id=&#34;1-下载源码&#34;&gt;1. 下载源码&lt;/h3&gt;

&lt;p&gt;在macOS中，先用brew安装mercurial代码版本管理工具&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;brew install mercurial
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;获取源码：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;hg clone http://hg.openjdk.java.net/jdk7u/jdk7u-dev
cd jdk7u-dev
chmod 755 get_source.sh
./get_source.sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;而国内的网络到了&lt;code&gt;./get_source.sh&lt;/code&gt;这一步，下载过程中总是会网络异常中断，所以我是在国外的vps上面下载好之后，再压缩拉回来的。&lt;/p&gt;

&lt;h3 id=&#34;2-安装xcode和command-line-tools-for-xcode&#34;&gt;2. 安装XCode和Command Line Tools for XCode&lt;/h3&gt;

&lt;p&gt;由于我之前已经安装了，所以这一步跳过，具体的版本可以看0x01编译环境中的描述&lt;/p&gt;

&lt;h3 id=&#34;3-准备一个bootstrap-sdk&#34;&gt;3. 准备一个Bootstrap SDK&lt;/h3&gt;

&lt;p&gt;书中说到，“如果编译OpenJDK 7，Bootstrap JDK必须使用JDK6 Update 14或之后的版本”，而我用的是JDK1.7.80版本。&lt;/p&gt;

&lt;h3 id=&#34;4-安装apache-ant&#34;&gt;4. 安装Apache Ant&lt;/h3&gt;

&lt;p&gt;Apache Ant 对版本有要求，1.7.1以上即可。
同时，Apache Ant 官网上有一句话必须要看一下：&lt;br /&gt;
&amp;ldquo;The 1.9.x releases require Java5 at runtime and 1.10.x requires Java8 at runtime. &amp;rdquo;&lt;br /&gt;
大意就是1.9.x版本的ant 要求Java5以上版本的jre，而1.10.x版本的ant则要求Java8以上版本的jre。&lt;/p&gt;

&lt;h2 id=&#34;0x03-编译&#34;&gt;0x03 编译&lt;/h2&gt;

&lt;p&gt;书中作者给出的编译脚本如下：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;#语言选项，这个必须设置，否则编译好后会出现一个HashTable的NPE错
export LANG=C
#Bootstrap JDK的安装路径。必须设置
export ALT_BOOTDIR=/Library/Java/JavaVirtualMachines/jdk1.7.0_04.jdk/Contents/Home
#允许自动下载依赖
export ALLOW_DOWNLOADS=true
#并行编译的线程数，设置为和CPU内核数量一致即可
export HOTSPOT_BUILD_JOBS=6
export ALT_PARALLEL_COMPILE_JOBS=6
#比较本次build出来的映像与先前版本的差异。这对我们来说没有意义，
#必须设置为false，否则sanity检查会报缺少先前版本JDK的映像的错误提示。
#如果已经设置dev或者DEV_ONLY=true，这个不显式设置也行
export SKIP_COMPARE_IMAGES=true
#使用预编译头文件，不加这个编译会更慢一些
export USE_PRECOMPILED_HEADER=true
#要编译的内容
export BUILD_LANGTOOLS=true
#export BUILD_JAXP=false
#export BUILD_JAXWS=false
#export BUILD_CORBA=false
export BUILD_HOTSPOT=true
export BUILD_JDK=true
#要编译的版本
#export SKIP_DEBUG_BUILD=false
#export SKIP_FASTDEBUG_BUILD=true
#export DEBUG_NAME=debug
#把它设置为false可以避开javaws和浏览器Java插件之类的部分的build
BUILD_DEPLOY=false
#把它设置为false就不会build出安装包。因为安装包里有些奇怪的依赖，
#但即便不build出它也已经能得到完整的JDK映像，所以还是别build它好了
BUILD_INSTALL=false
#编译结果所存放的路径
export ALT_OUTPUTDIR=/Users/IcyFenix/Develop/JVM/jdkBuild/openjdk_7u4/build
#这两个环境变量必须去掉，不然会有很诡异的事情发生（我没有具体查过这些&amp;quot;诡异的
#事情&amp;quot;，Makefile脚本检查到有这2个变量就会提示警告）
unset JAVA_HOME
unset CLASSPATH
make 2&amp;gt;&amp;amp;1|tee $ALT_OUTPUTDIR/build.log
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;0x04-坑&#34;&gt;0x04 坑&lt;/h2&gt;

&lt;h3 id=&#34;1-llvm-gcc-缺失导致的freetype-versioncheck的编译错误&#34;&gt;1.llvm-gcc 缺失导致的freetype_versioncheck的编译错误&lt;/h3&gt;

&lt;p&gt;首先最底下出现的是：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ERROR: The Compiler version is undefined. 
 
ERROR: FreeType version  2.3.0  or higher is required. 
 /bin/mkdir -p /Users/jackietsoi/Documents/develop/jdk7u-dev/JVM/jdkBuild/openjdk_7u4/build/btbins
rm -f /Users/jackietsoi/Documents/develop/jdk7u-dev/JVM/jdkBuild/openjdk_7u4/build/btbins/freetype_versioncheck
Failed to build freetypecheck.  

Exiting because of the above error(s).
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;上网搜了一下，还以为是缺失FreeType，于是根据网友说的安装XQuartz(&lt;a href=&#34;http://xquartz.macosforge.org/landing/)，因为XQuartz里面自带了freetype2，但是安装之后并没有解决问题，于是继续往上看输出:&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;http://xquartz.macosforge.org/landing/)，因为XQuartz里面自带了freetype2，但是安装之后并没有解决问题，于是继续往上看输出:&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;make[2]: /Applications/Xcode.app/Contents/Developer/usr/bin/llvm-gcc: No such file or directory
make[2]: *** [/Users/jackietsoi/Documents/develop/jdk7u-dev/JVM/jdkBuild/openjdk_7u4/build/btbins/freetype_versioncheck] Error 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo ln -s /usr/bin/llvm-g++ /Library/Developer/CommandLineTools/usr/bin/llvm-g++
sudo ln -s /usr/bin/llvm-gcc /Library/Developer/CommandLineTools/usr/bin/llvm-gcc
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;2-cups-头文件缺失问题&#34;&gt;2.cups 头文件缺失问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;ERROR: You do not have access to valid Cups header files. 
       Please check your access to 
           /usr/include/cups/cups.h 
       and/or check your value of ALT_CUPS_HEADERS_PATH, 
       CUPS is frequently pre-installed on many systems, 
       or may be downloaded from http://www.cups.org 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
到 &lt;a href=&#34;http://www.cups.org&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;http://www.cups.org&lt;/a&gt; 去下载cups2.3.3 然后解压整个文件夹，放到编译项目根目录
然后在编译脚本文件中加入一句：&lt;code&gt;export ALT_CUPS_HEADERS_PATH=/Users/jackietsoi/Documents/develop/jdk7u-dev/cups-2.3.3&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;3-freetype-版本问题&#34;&gt;3.freetype 版本问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;ERROR: FreeType version  2.3.0  or higher is required. 
 /Users/jackietsoi/Documents/develop/jdk7u-dev/JVM/jdkBuild/openjdk_7u4/build/btbins/freetype_versioncheck
Required version of freetype: 2.3.0
Detected freetype headers: 2.10.4
Failed: headers are too old.
Detected freetype library: 2.10.4
Failed: too old library.  

Exiting because of the above error(s). 
 
make: *** [post-sanity] Error 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;去官网(&lt;a href=&#34;https://www.freetype.org/download.html)下载&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;https://www.freetype.org/download.html)下载&lt;/a&gt; freetype-2.3.0 版本压缩包&lt;br /&gt;
解压，进入根目录执行以下命令进行编译，并安装：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;./configure
make
make install
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;在编译脚本文件中加入两句：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;export ALT_FREETYPE_HEADERS_PATH=/usr/local/include
export ALT_FREETYPE_LIB_PATH=/usr/local/lib
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;4-ant-1-10-x-要求最低jdk8问题&#34;&gt;4.ant 1.10.x 要求最低jdk8问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;Exception in thread &amp;quot;main&amp;quot; java.lang.UnsupportedClassVersionError: org/apache/tools/ant/launch/Launcher : Unsupported major.minor version 52.0
    at java.lang.ClassLoader.defineClass1(Native Method)
    at java.lang.ClassLoader.defineClass(ClassLoader.java:791)
    at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
    at java.net.URLClassLoader.defineClass(URLClassLoader.java:449)
    at java.net.URLClassLoader.access$100(URLClassLoader.java:71)
    at java.net.URLClassLoader$1.run(URLClassLoader.java:361)
    at java.net.URLClassLoader$1.run(URLClassLoader.java:355)
    at java.security.AccessController.doPrivileged(Native Method)
    at java.net.URLClassLoader.findClass(URLClassLoader.java:354)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:423)
    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:356)
    at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:480)
Exception in thread &amp;quot;main&amp;quot; java.lang.UnsupportedClassVersionError: org/apache/tools/ant/launch/Launcher : Unsupported major.minor version 52.0
    at java.lang.ClassLoader.defineClass1(Native Method)
    at java.lang.ClassLoader.defineClass(ClassLoader.java:791)
    at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
    at java.net.URLClassLoader.defineClass(URLClassLoader.java:449)
    at java.net.URLClassLoader.access$100(URLClassLoader.java:71)
    at java.net.URLClassLoader$1.run(URLClassLoader.java:361)
    at java.net.URLClassLoader$1.run(URLClassLoader.java:355)
    at java.security.AccessController.doPrivileged(Native Method)
    at java.net.URLClassLoader.findClass(URLClassLoader.java:354)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:423)
    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:356)
    at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:480)
make[2]: *** [/Users/jackietsoi/Documents/develop/jdk7u-dev/JVM/jdkBuild/openjdk_7u4/build/langtools/build/ant-diagnostics.log] Error 1
make[1]: *** [langtools-build] Error 2
make: *** [build_product_image] Error 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
到Apache Ant官网(&lt;a href=&#34;http://ant.apache.org/bindownload.cgi)下载&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;http://ant.apache.org/bindownload.cgi)下载&lt;/a&gt; 1.9.x版本的ant，将压缩包解压到一个目录下，如/usr/local&lt;/p&gt;

&lt;p&gt;配置环境变量：&lt;br /&gt;
编辑 ~/.zshrc，在末尾加入两行：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;export ANT_HOME=/usr/local/apache-ant-1.9.15
export PATH=$ANT_HOME/bin:$PATH
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然后 source ~/.zshrc 使其生效&lt;/p&gt;

&lt;h3 id=&#34;5-jdk版本问题&#34;&gt;5.jdk版本问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;[javac] Compiling 298 source files to /Users/jackietsoi/Documents/develop/jdk7u-dev/JVM/jdkBuild/openjdk_7u4/build/langtools/build/bootstrap/classes
    [javac] /Users/jackietsoi/Documents/develop/jdk7u-dev/langtools/src/share/classes/com/sun/tools/javac/comp/Resolve.java:2182: ??: [overrides] ?Resolve.InapplicableSymbolsError.Candidate??? equals, ???????????? hashCode ??
    [javac]         private class Candidate {
    [javac]                 ^
    [javac] ??: ????, ???? -Werror
    [javac] 1 ???
    [javac] 1 ???

BUILD FAILED
/Users/jackietsoi/Documents/develop/jdk7u-dev/langtools/make/build.xml:452: The following error occurred while executing this line:
/Users/jackietsoi/Documents/develop/jdk7u-dev/langtools/make/build.xml:795: Compile failed; see the compiler error output for details.

Total time: 4 seconds
make[2]: *** [build] Error 1
make[1]: *** [langtools-build] Error 2
make: *** [build_product_image] Error 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
将Bootstrap JDK 从1.8换到1.7即可，下载jdk7(&lt;a href=&#34;https://www.oracle.com/java/technologies/javase/javase7-archive-downloads.html&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;https://www.oracle.com/java/technologies/javase/javase7-archive-downloads.html&lt;/a&gt;)&lt;br /&gt;
这里我下载的是jdk7u80，然后在编译脚本更改Bootstrap JDK的路径：&lt;br /&gt;
&lt;code&gt;export ALT_BOOTDIR=/Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;6-warning-转义错误&#34;&gt;6. warning 转义错误&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/filebuff.cpp:109:8: error: &#39;this&#39; pointer cannot be null in well-defined C++ code; pointer may be assumed to always convert to true [-Werror,-Wundefined-bool-conversion]
  if( !this ) return NULL;      // The empty buffer region
      ~^~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/filebuff.cpp:122:8: error: &#39;this&#39; pointer cannot be null in well-defined C++ code; pointer may be assumed to always convert to true [-Werror,-Wundefined-bool-conversion]
  if( !this ) return br;        // Merging into nothing
      ~^~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/filebuff.cpp:228:8: error: reference cannot be bound to dereferenced null pointer in well-defined C++ code; comparison may be assumed to always evaluate to false [-Werror,-Wtautological-undefined-compare]
  if( &amp;amp;br == NULL ) return os;  // The empty buffer region
       ^~    ~~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/filebuff.cpp:244:8: error: &#39;this&#39; pointer cannot be null in well-defined C++ code; pointer may be assumed to always convert to true [-Werror,-Wundefined-bool-conversion]
  if( !this ) return;           // Nothing to print
      ~^~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/archDesc.cpp:335:35: error: &#39;&amp;amp;&amp;amp;&#39; within &#39;||&#39; [-Werror,-Wlogical-op-parentheses]
    if ( instr-&amp;gt;is_ideal_branch() &amp;amp;&amp;amp; instr-&amp;gt;label_position() == -1 ||
         ~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/archDesc.cpp:335:35: note: place parentheses around the &#39;&amp;amp;&amp;amp;&#39; expression to silence this warning
    if ( instr-&amp;gt;is_ideal_branch() &amp;amp;&amp;amp; instr-&amp;gt;label_position() == -1 ||
                                  ^
         (                                                        )
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/archDesc.cpp:336:35: error: &#39;&amp;amp;&amp;amp;&#39; within &#39;||&#39; [-Werror,-Wlogical-op-parentheses]
        !instr-&amp;gt;is_ideal_branch() &amp;amp;&amp;amp; instr-&amp;gt;label_position() != -1) {
        ~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/archDesc.cpp:336:35: note: place parentheses around the &#39;&amp;amp;&amp;amp;&#39; expression to silence this warning
        !instr-&amp;gt;is_ideal_branch() &amp;amp;&amp;amp; instr-&amp;gt;label_position() != -1) {
                                  ^
        (                                                         )
4 errors generated.
2 errors generated.
make[8]: *** [../generated/adfiles/filebuff.o] Error 1
make[8]: *** Waiting for unfinished jobs....
make[8]: *** [../generated/adfiles/archDesc.o] Error 1
Compiling /Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/forms.cpp
rm -f ../generated/adfiles/forms.o
llvm-g++ -D_ALLBSD_SOURCE -D_GNU_SOURCE -DAMD64 -I/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/prims -I/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm -I/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/precompiled -I/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/cpu/x86/vm -I/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/os_cpu/bsd_x86/vm -I/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/os/bsd/vm -I/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/os/posix/vm -I/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc -I../generated -DASSERT -DTARGET_OS_FAMILY_bsd -DTARGET_ARCH_x86 -DTARGET_ARCH_MODEL_x86_64 -DTARGET_OS_ARCH_bsd_x86 -DTARGET_OS_ARCH_MODEL_bsd_x86_64 -DTARGET_COMPILER_gcc -DCOMPILER2 -DCOMPILER1  -fno-rtti -fno-exceptions -pthread -fcheck-new -fvisibility=hidden -m64 -pipe -Werror -g -c -o ../generated/adfiles/forms.o /Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/forms.cpp 
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:3217:71: error: equality comparison with extraneous parentheses [-Werror,-Wparentheses-equality]
    if ( ((primary = get_ident_or_literal_constant(&amp;quot;primary opcode&amp;quot;)) == NULL) ) {
          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:3217:71: note: remove extraneous parentheses around the comparison to silence this warning
    if ( ((primary = get_ident_or_literal_constant(&amp;quot;primary opcode&amp;quot;)) == NULL) ) {
         ~                                                            ^      ~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:3217:71: note: use &#39;=&#39; to turn this equality comparison into an assignment
    if ( ((primary = get_ident_or_literal_constant(&amp;quot;primary opcode&amp;quot;)) == NULL) ) {
                                                                      ^~
                                                                      =
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:3226:77: error: equality comparison with extraneous parentheses [-Werror,-Wparentheses-equality]
      if ( ((secondary = get_ident_or_literal_constant(&amp;quot;secondary opcode&amp;quot;)) == NULL) ) {
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:3226:77: note: remove extraneous parentheses around the comparison to silence this warning
      if ( ((secondary = get_ident_or_literal_constant(&amp;quot;secondary opcode&amp;quot;)) == NULL) ) {
           ~                                                                ^      ~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:3226:77: note: use &#39;=&#39; to turn this equality comparison into an assignment
      if ( ((secondary = get_ident_or_literal_constant(&amp;quot;secondary opcode&amp;quot;)) == NULL) ) {
                                                                            ^~
                                                                            =
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:3235:77: error: equality comparison with extraneous parentheses [-Werror,-Wparentheses-equality]
        if ( ((tertiary = get_ident_or_literal_constant(&amp;quot;tertiary opcode&amp;quot;)) == NULL) ) {
              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:3235:77: note: remove extraneous parentheses around the comparison to silence this warning
        if ( ((tertiary = get_ident_or_literal_constant(&amp;quot;tertiary opcode&amp;quot;)) == NULL) ) {
             ~                                                              ^      ~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:3235:77: note: use &#39;=&#39; to turn this equality comparison into an assignment
        if ( ((tertiary = get_ident_or_literal_constant(&amp;quot;tertiary opcode&amp;quot;)) == NULL) ) {
                                                                            ^~
                                                                            =
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:4476:21: error: &#39;&amp;amp;&amp;amp;&#39; within &#39;||&#39; [-Werror,-Wlogical-op-parentheses]
  while ((c &amp;gt;= &#39;0&#39;) &amp;amp;&amp;amp; (c &amp;lt;= &#39;9&#39;)
         ~~~~~~~~~~~^~~~~~~~~~~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:4476:21: note: place parentheses around the &#39;&amp;amp;&amp;amp;&#39; expression to silence this warning
  while ((c &amp;gt;= &#39;0&#39;) &amp;amp;&amp;amp; (c &amp;lt;= &#39;9&#39;)
                    ^
         (                       )
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:4515:17: error: equality comparison with extraneous parentheses [-Werror,-Wparentheses-equality]
    if( (second == &#39;=&#39;) ) {
         ~~~~~~~^~~~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:4515:17: note: remove extraneous parentheses around the comparison to silence this warning
    if( (second == &#39;=&#39;) ) {
        ~       ^     ~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/adlc/adlparse.cpp:4515:17: note: use &#39;=&#39; to turn this equality comparison into an assignment
    if( (second == &#39;=&#39;) ) {
                ^~
                =
5 errors generated.
make[8]: *** [../generated/adfiles/adlparse.o] Error 1
make[7]: *** [ad_stuff] Error 2
make[6]: *** [product] Error 2
make[5]: *** [generic_build2] Error 2
make[4]: *** [product] Error 2
make[3]: *** [all_product_universal] Error 2
make[2]: *** [universal_product] Error 2
make[1]: *** [hotspot-build] Error 2
make: *** [build_product_image] Error 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
关掉warning警告，打开编译脚本加入一行&lt;code&gt;export COMPILER_WARNINGS_FATAL=false&lt;/code&gt;，继续执行即可&lt;/p&gt;

&lt;h3 id=&#34;7-clang-error-unknown-argument-fpch-deps-错误&#34;&gt;7. clang: error: unknown argument: &amp;lsquo;-fpch-deps&amp;rsquo;错误&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;clang: error: unknown argument: &#39;-fpch-deps&#39;
make[8]: *** [precompiled.hpp.gch] Error 1
make[7]: *** [the_vm] Error 2
make[6]: *** [product] Error 2
make[5]: *** [generic_build2] Error 2
make[4]: *** [product] Error 2
make[3]: *** [all_product_universal] Error 2
make[2]: *** [universal_product] Error 2
make[1]: *** [hotspot-build] Error 2
make: *** [build_product_image] Error 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
&lt;code&gt;vi ./hotspot/make/bsd/makefiles/gcc.make&lt;/code&gt;将以下两段代码注释掉&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#ifneq ($(COMPILER_WARNINGS_FATAL),false)
#  WARNINGS_ARE_ERRORS = -Werror
#endif
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;#ifneq (&amp;quot;${CC_VER_MAJOR}&amp;quot;, &amp;quot;2&amp;quot;)
#DEPFLAGS = -fpch-deps -MMD -MP -MF $(DEP_DIR)/$(@:%=%.d)
#endif
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;8-error-friend-declaration-specifying-a-default-argument-must-be-a-definition-错误&#34;&gt;8.error: friend declaration specifying a default argument must be a definition 错误&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/code/relocInfo.hpp:374:27: error: friend declaration specifying a default argument must be a definition
  inline friend relocInfo prefix_relocInfo(int datalen = 0);
                          ^
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/code/relocInfo.hpp:469:18: error: friend declaration specifying a default argument must be the only declaration
inline relocInfo prefix_relocInfo(int datalen) {
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：
&lt;code&gt;vi hotspot/src/share/vm/code/relocInfo.hpp&lt;/code&gt;&lt;br /&gt;
将&lt;code&gt;inline friend relocInfo prefix_relocInfo(int datalen = 0);&lt;/code&gt;改成
&lt;code&gt;inline friend relocInfo prefix_relocInfo(int datalen);&lt;/code&gt;&lt;br /&gt;
将&lt;code&gt;inline relocInfo prefix_relocInfo(int datalen) {&lt;/code&gt;改成&lt;code&gt;inline relocInfo prefix_relocInfo(int datalen = 0) {&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;9-指针与0比较问题&#34;&gt;9.指针与0比较问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/runtime/virtualspace.cpp:527:14: error: ordered comparison between pointer and zero (&#39;char *&#39; and &#39;int&#39;)
  if (base() &amp;gt; 0) {
      ~~~~~~ ^ ~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/src/share/vm/runtime/virtualspace.cpp:546:14: error: ordered comparison between pointer and zero (&#39;char *&#39; and &#39;int&#39;)
  if (base() &amp;gt; 0) {
      ~~~~~~ ^ ~
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
&lt;code&gt;vi ./hotspot/src/share/vm/runtime/virtualspace.cpp&lt;/code&gt;&lt;br /&gt;
用&lt;code&gt;/if (base() &amp;gt; 0)&lt;/code&gt;查找所有该语句，并将其改成&lt;code&gt;if (base() != NULL)&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;10-找不到javanativefoundation-h头文件问题&#34;&gt;10.找不到JavaNativeFoundation.h头文件问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/agent/src/os/bsd/MacosxDebuggerLocal.m:27:9: fatal error: &#39;JavaNativeFoundation/JavaNativeFoundation.h&#39; file not found
#import &amp;lt;JavaNativeFoundation/JavaNativeFoundation.h&amp;gt;
        ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
/Users/jackietsoi/Documents/develop/jdk7u-dev/hotspot/agent/src/os/bsd/MacosxDebuggerLocal.m:27:9: note: did not find header &#39;JavaNativeFoundation.h&#39; in framework &#39;JavaNativeFoundation&#39; (loaded from &#39;/System/Library/Frameworks/JavaVM.framework/Frameworks&#39;)
1 error generated.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
终端执行&lt;code&gt;find / -name &amp;quot;*JavaNativeFoundation.h*&amp;quot;&lt;/code&gt;命令，出现结果：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/Library/Developer/CommandLineTools/SDKs/MacOSX10.14.sdk/System/Library/Frameworks/JavaVM.framework/Versions/A/Frameworks/JavaNativeFoundation.framework/Versions/A/Headers/JavaNativeFoundation.h
/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/JavaVM.framework/Versions/A/Frameworks/JavaNativeFoundation.framework/Versions/A/Headers/JavaNativeFoundation.h
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;编辑&lt;code&gt;hotspot/make/bsd/makefiles/saproc.make&lt;/code&gt;进行如下修改：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;原：
SALIBS = -g -framework Foundation -F/System/Library/Frameworks/JavaVM.framework/Frameworks -framework JavaNativeFoundation -framework Security -framework CoreFoundation
修改后：
SALIBS = -g -framework Foundation -F/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/System/Library/Frameworks -framework JavaNativeFoundation -framework Security -framework CoreFoundation

原：
-I/System/Library/Frameworks/JavaVM.framework/Headers
修改后：
-I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/JavaVM.framework/Versions/A/Frameworks/JavaNativeFoundation.framework/Versions/A/Headers
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;11-undefined-symbols-for-architecture-x86-64&#34;&gt;11.Undefined symbols for architecture x86_64&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;llvm-gcc -m64   -m64  -L`pwd`  -framework CoreFoundation  -o gamma launcher/java_md.o launcher/java.o launcher/jli_util.o launcher/wildcard.o -ljvm -lm -pthread
Undefined symbols for architecture x86_64:
  &amp;quot;_JNI_CreateJavaVM&amp;quot;, referenced from:
      _LoadJavaVM in java_md.o
  &amp;quot;_JNI_GetDefaultJavaVMInitArgs&amp;quot;, referenced from:
      _LoadJavaVM in java_md.o
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[8]: *** [gamma] Error 1
make[7]: *** [the_vm] Error 2
make[6]: *** [product] Error 2
make[5]: *** [generic_build2] Error 2
make[4]: *** [product] Error 2
make[3]: *** [all_product_universal] Error 2
make[2]: *** [universal_product] Error 2
make[1]: *** [hotspot-build] Error 2
make: *** [build_product_image] Error 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
这个错误困扰了我很久，一开始看上面的&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Linking vm...
ld: warning: cannot export hidden symbol _AsyncGetCallTrace from forte.o
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;还以为是export symbol过程中出现问题，修改过jdk/src/macosx/native/sun/osxapp/ThreadUtilities.中的attachCurrentThread函数，改为static，还是无法解决问题&lt;br /&gt;
后面上stackflow上面搜了以下，发现应该是llvm-gcc编译的时候，找不到库文件导致的，仔细看了以下编译命令&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;llvm-gcc -m64   -m64  -L`pwd`...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;其中-L是指定库文件目录，它指向了当前pwd即目录，然后我&lt;code&gt;find ./ -name &amp;quot;java_md.o&amp;quot;&lt;/code&gt;,发现它在&lt;code&gt;.//JVM/jdkBuild/openjdk_7u4/build/hotspot/outputdir/bsd_amd64_compiler2/product/launcher/java_md.o&lt;/code&gt;，那么此时pwd就应该在&lt;code&gt;.//JVM/jdkBuild/openjdk_7u4/build/hotspot/outputdir/bsd_amd64_compiler2/product&lt;/code&gt;，而当前编译所需要的库文件是&lt;code&gt;/Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home/jre/lib/server/libjvm.dylib&lt;/code&gt;&lt;br /&gt;
使用cp命令将其复制到pwd就好了：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo cp /Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home/jre/lib/server/libjvm.dylib ./JVM/jdkBuild/openjdk_7u4/build/hotspot/outputdir/bsd_amd64_compiler2/product
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;12-找不到cgbase-h头文件问题&#34;&gt;12.找不到CGBase.h头文件问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks/Foundation.framework/Headers/NSGeometry.h:9:9: fatal error: 
      &#39;CoreGraphics/CGBase.h&#39; file not found
#import &amp;lt;CoreGraphics/CGBase.h&amp;gt;
        ^~~~~~~~~~~~~~~~~~~~~~~
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks/Foundation.framework/Headers/NSGeometry.h:9:9: note: 
      did not find header &#39;CGBase.h&#39; in framework &#39;CoreGraphics&#39; (loaded from
      &#39;/System/Library/Frameworks/ApplicationServices.framework/Frameworks&#39;)
1 error generated.
make[5]: *** [/Users/jackietsoi/Documents/develop/jdk7u-dev/JVM/jdkBuild/openjdk_7u4/build/tmp/java/java.lang/java/obj64/java_props_macosx.o] Error 1
make[4]: *** [library_parallel_compile] Error 2
make[3]: *** [all] Error 1
make[2]: *** [all] Error 1
make[1]: *** [jdk-build] Error 2
make: *** [build_product_image] Error 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
&lt;code&gt;vi ./jdk/make/common/Defs-macosx.gmk&lt;/code&gt;进行如下更改：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#OTHER_CFLAGS = \
#         -F/System/Library/Frameworks/JavaVM.framework/Frameworks \
#       -F/System/Library/Frameworks/CoreGraphics.framework \
#        -F/System/Library/Frameworks/ApplicationServices.framework/Frameworks

OTHER_CFLAGS = \
      -F/Library/Developer/CommandLineTools/SDKs/MacOSX10.14.sdk/System/Library/Frameworks/JavaVM.framework/Frameworks \
      -F/Library/Developer/CommandLineTools/SDKs/MacOSX10.14.sdk/System/Library/Frameworks/CoreGraphics.framework/Frameworks \
     -F/Library/Developer/CommandLineTools/SDKs/MacOSX10.14.sdk/System/Library/Frameworks/ApplicationServices.framework/Frameworks
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;同样使用&lt;code&gt;find ./ -name &amp;quot;CGBase.h&amp;quot;&lt;/code&gt;找到路径，将&lt;code&gt;/System/Library/Frameworks/JavaVM.framework/Frameworks&lt;/code&gt;等路径替换掉即可。&lt;/p&gt;

&lt;h3 id=&#34;15-从macos14-sdk开始不再支持32位程序编译&#34;&gt;15 从macOS14 sdk开始不再支持32位程序编译&lt;/h3&gt;

&lt;p&gt;awt库的编译需要有i386架构的库的支持，但是Apple从macOS14 sdk开始就不再包含32位程序编译支持了，最后一个支持32位程序编译的版本是macOS13 sdk。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ld: warning: The i386 architecture is deprecated for macOS (remove from the Xcode build setting: ARCHS)
ld: warning: ignoring file /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libSystem.tbd, missing required architecture i386 in file /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libSystem.tbd
Undefined symbols for architecture i386:
  &amp;quot;___stack_chk_fail&amp;quot;, referenced from:
      _main in sizer-32b644.o
  &amp;quot;___stack_chk_guard&amp;quot;, referenced from:
      _main in sizer-32b644.o
  &amp;quot;_printf&amp;quot;, referenced from:
      _main in sizer-32b644.o
ld: symbol(s) not found for architecture i386
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[4]: *** [/Users/jackietsoi/Documents/develop/jdk7u-dev/JVM/jdkBuild/openjdk_7u4/build/gensrc/sun/awt/X11/generator/sizer.32] Error 1
make[3]: *** [all] Error 1
make[2]: *** [all] Error 1
make[1]: *** [jdk-build] Error 2
make: *** [build_product_image] Error 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法：&lt;br /&gt;
我也尝试去下载了Command_Line_Tools_macOS_10.13_for_Xcode_10.1.dmg进行安装，但是却提示“该软件包与此版本的macOS不兼容”，有兴趣的朋友可以自己再试一下，我就不再折腾了。最后给出最后给出Command Line Tools的下载地址&lt;code&gt;https://developer.apple.com/download/more/&lt;/code&gt;。&lt;/p&gt;

&lt;h2 id=&#34;0x05-总结&#34;&gt;0x05 总结&lt;/h2&gt;

&lt;p&gt;在macOS中编译openjdk7也折腾了两天，最终还是以失败告终，接下来我将使用Ubuntu16.04进行再一次编译尝试，敬请期待。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>如何生成VMESS URL并发布订阅</title>
      <link>http://blog.sinowrt.cn/2020/2020-12-01t2202-how-to-generate-vmess-urls-and-public-as-subscription/</link>
      <pubDate>Tue, 01 Dec 2020 22:02:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2020/2020-12-01t2202-how-to-generate-vmess-urls-and-public-as-subscription/</guid>
      <description>

&lt;h2 id=&#34;0x00-获得vmess-url&#34;&gt;0x00 获得VMESS URL&lt;/h2&gt;

&lt;p&gt;我使用的是V2rayN客户端，直接全选所有节点，然后&lt;code&gt;批量导出分享URL到剪切板&lt;/code&gt;即可&lt;/p&gt;

&lt;h2 id=&#34;0x01-发布订阅信息&#34;&gt;0x01 发布订阅信息&lt;/h2&gt;

&lt;p&gt;订阅信息实际上就是将VMESS URL（每个URL以回车符分隔）进行Base64加密，得到密文做成纯text网页，随便丢到一个安装了apache或nginx服务的服务器即可&lt;/p&gt;

&lt;p&gt;测试方法：在浏览器输入该订阅的网址，能访问到完整的Base64密文即可&lt;/p&gt;

&lt;h2 id=&#34;0x02-发布quantumult订阅信息&#34;&gt;0x02 发布quantumult订阅信息&lt;/h2&gt;

&lt;p&gt;quantumult的订阅信息格式跟V2rayN的不太一样，在这里我还踩了一个小坑，且听我详细道来&lt;/p&gt;

&lt;p&gt;这里要用到一个&lt;a href=&#34;https://quan.eicky.com/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;小工具&lt;/a&gt;，将V2rayN的vmess url转成符合Quantumult格式的vmess url&lt;/p&gt;

&lt;p&gt;这是示例的vmess url
&lt;code&gt;vmess://ew0KICAidiI6ICIyIiwNCiAgInBzIjogIuekuuS+iyIsDQogICJhZGQiOiAiMTkyLjE2OC4xLjEiLA0KICAicG9ydCI6ICI0MzIxIiwNCiAgImlkIjogImQ3NzFkODlhLTliZWQtNDc2Ny1hNjlkLTE5NjJkY2MyZTY3YyIsDQogICJhaWQiOiAiNjQiLA0KICAibmV0IjogIndzIiwNCiAgInR5cGUiOiAibm9uZSIsDQogICJob3N0IjogIiIsDQogICJwYXRoIjogIi9leGFtcGxlIiwNCiAgInRscyI6ICIiDQp9&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;使用小工具转换之后的Quantumult vmess url为&lt;/p&gt;

&lt;p&gt;&lt;code&gt;vmess://56S65L6LID0gdm1lc3MsMTkyLjE2OC4xLjEsNDMyMSxub25lLCJkNzcxZDg5YS05YmVkLTQ3NjctYTY5ZC0xOTYyZGNjMmU2N2MiLG92ZXItdGxzPWZhbHNlLHRscy1ob3N0PSxjZXJ0aWZpY2F0ZT0xLG9iZnM9d3Msb2Jmcy1wYXRoPSIvZXhhbXBsZSJvYmZzLWhlYWRlcj0iSG9zdDoi&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;首先，比较一下V2rayN和Quantumult的vmess url,两者看似非常相似，除了&lt;code&gt;vmess://&lt;/code&gt;相同之外完全不一样。可是你说它不一样吧，它也没个规律比较啥也无从下手&lt;/p&gt;

&lt;p&gt;既然订阅密文是将vmess url 通过base64加密之后得到的，那么vmess://后面这一串东西是不是也是通过base64加密得到的密文呢，那就解密试试吧&lt;/p&gt;

&lt;p&gt;这是V2rayN的Vmess://后一串密文解密的结果&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;v&amp;quot;: &amp;quot;2&amp;quot;,
  &amp;quot;ps&amp;quot;: &amp;quot;示例&amp;quot;,
  &amp;quot;add&amp;quot;: &amp;quot;192.168.1.1&amp;quot;,
  &amp;quot;port&amp;quot;: &amp;quot;4321&amp;quot;,
  &amp;quot;id&amp;quot;: &amp;quot;d771d89a-9bed-4767-a69d-1962dcc2e67c&amp;quot;,
  &amp;quot;aid&amp;quot;: &amp;quot;64&amp;quot;,
  &amp;quot;net&amp;quot;: &amp;quot;ws&amp;quot;,
  &amp;quot;type&amp;quot;: &amp;quot;none&amp;quot;,
  &amp;quot;host&amp;quot;: &amp;quot;&amp;quot;,
  &amp;quot;path&amp;quot;: &amp;quot;/example&amp;quot;,
  &amp;quot;tls&amp;quot;: &amp;quot;&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这是Quantumult的Vmess://后一串密文解密的结果&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;示例 = vmess,192.168.1.1,4321,none,&amp;quot;d771d89a-9bed-4767-a69d-1962dcc2e67c&amp;quot;,over-tls=false,tls-host=,certificate=1,obfs=ws,obfs-path=&amp;quot;/example&amp;quot;obfs-header=&amp;quot;Host:&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;通过比较，vmess://后面是base64加密的密文实锤了&lt;/p&gt;

&lt;p&gt;可是将这个vmess url追加到原有的url列表时，Quantumult却只能识别先前的url，而这个追加的无论是单独设为订阅，或是与原来的url一起设为订阅，都无法识别&lt;/p&gt;

&lt;p&gt;更神奇的是，小工具生成Quantumult订阅url时，会同时生成二维码，使用Quantumult应用扫描这个二维码，或者复制这个url通过剪贴板导入的方式，都可以成功识别并添加该服务器&lt;/p&gt;

&lt;p&gt;既然如此，那我们就看看这个Quantumult与原有的url列表中的服务器有什么不一样&lt;/p&gt;

&lt;p&gt;新的Quantumult vmess url&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;示例 = vmess,192.168.1.1,4321,none,&amp;quot;d771d89a-9bed-4767-a69d-1962dcc2e67c&amp;quot;,over-tls=false,tls-host=,certificate=1,obfs=ws,obfs-path=&amp;quot;/example&amp;quot;obfs-header=&amp;quot;Host:&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;旧列表中的Quantumult vmess url&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;示例 = vmess,192.168.1.1,4321,none,&amp;quot;d771d89a-9bed-4767-a69d-1962dcc2e67c&amp;quot;,group=Fndroid,over-tls=false,tls-host=,certificate=1,obfs=ws,obfs-path=&amp;quot;/example&amp;quot;obfs-header=&amp;quot;Host:&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;可以看到，只是多了一个group字段，于是将原来的url添加上group字段，然后base64加密这段字符串追加到vmess://后面&lt;/p&gt;

&lt;p&gt;将这个vmess url追加到原有的vmess url列表中，并将url列表进行base64加密，就可以发布订阅了&lt;/p&gt;

&lt;p&gt;当然这次是能够识别并添加成功了&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>安装新版v2ray服务端</title>
      <link>http://blog.sinowrt.cn/2020/2020-09-15t2314-how-to-install-the-lasted-v2ray/</link>
      <pubDate>Tue, 15 Sep 2020 23:14:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2020/2020-09-15t2314-how-to-install-the-lasted-v2ray/</guid>
      <description>

&lt;h2 id=&#34;0x00-问题&#34;&gt;0x00 问题&lt;/h2&gt;

&lt;p&gt;在使用旧教程安装v2ray的时候，出现如下错误提示&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ERROR: This script has been DISCARDED, please switch to fhs-install-v2ray project.
HOW TO USE: https://github.com/v2fly/fhs-install-v2ray
TO MIGRATE: https://github.com/v2fly/fhs-install-v2ray/wiki/Migrate-from-the-old-script-to-this
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;意思是旧版的安装脚本已经停止使用，可以到&lt;code&gt;https://github.com/v2fly/fhs-install-v2ray&lt;/code&gt;查看新脚本的使用说明&lt;/p&gt;

&lt;h2 id=&#34;0x01-安装步骤&#34;&gt;0x01 安装步骤&lt;/h2&gt;

&lt;h3 id=&#34;1-使用新脚本安装v2ray&#34;&gt;1.使用新脚本安装v2ray&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;bash &amp;lt;(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;2-配置config-json文件&#34;&gt;2.配置config.json文件&lt;/h3&gt;

&lt;p&gt;需要注意的是，新版的config.json文件默认路径从&lt;code&gt;\etc\v2ray\config.json&lt;/code&gt;换到了&lt;code&gt;\usr\local\etc\v2ray\config.json&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;由于我在本地备份又config.json，就不再重复配置了&lt;/p&gt;

&lt;p&gt;将自带的config.json重命名为config.json.bak，留个备份，然后用xftp把本地的config.json上传到服务器对应目录中&lt;/p&gt;

&lt;p&gt;要了解如何配置config.json的可以参考&lt;a href=&#34;https://blog.sinowrt.cn/2019/2019-06-13t1300-how-to-save-the-baned-ip/&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;旧教程&lt;/a&gt;里面的服务端配置模板&lt;/p&gt;

&lt;p&gt;最后附上V2ray新官网地址：&lt;a href=&#34;https://www.v2fly.org/guide/start.html&#34; rel=&#34;nofollow noreferrer&#34; target=&#34;_blank&#34;&gt;https://www.v2fly.org/guide/start.html&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>群晖 moments 中的视频不显示缩略图</title>
      <link>http://blog.sinowrt.cn/2020/2020-08-16t2053-synology-moments-preview-pictures-of-videos-was-damaged/</link>
      <pubDate>Sun, 16 Aug 2020 14:27:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2020/2020-08-16t2053-synology-moments-preview-pictures-of-videos-was-damaged/</guid>
      <description>

&lt;h2 id=&#34;0x00-问题描述&#34;&gt;0x00 问题描述&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;为了解决照片备份的问题，我在群晖上安装了moments，但是一直以来都有一个问题，就是备份的所有视频在moments里面的缩略图都是显示损坏的，看着很不是滋味，就上网查了一下是什么原因。一圈下来，都说要看到缩略图的话，需要半洗白，那就洗白吧。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;0x01-半洗白-其实根本不能解决问题&#34;&gt;0x01 半洗白（其实根本不能解决问题）&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;根据网上的资料，半洗白一共有两种方法：&lt;/li&gt;
&lt;li&gt;一是通过算号，算出该型号的sn码，然后修改引导配置中的sn，从而达到半洗白&lt;/li&gt;
&lt;li&gt;二是通过再docker中安装DDSM，进入虚拟的群晖系统，获取体验的sn号，然后跟方法一同样的，将该SN填入引导配置中&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;而新版的docker中已经将DDSM功能去掉了，所以使用方法二的话，需要卸载重装旧版的docker，再下载pat安装体验版的系统。整个过程过于繁琐，就不考虑方法二了。&lt;/p&gt;

&lt;p&gt;所以下面就详细描述方法一的操作过程：&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>python3.8 在安装 python-docx 时提示未安装libxml2</title>
      <link>http://blog.sinowrt.cn/2020/2020-07-22t1231-could-not-find-function-xmlcheckversion-in-library-libxml2.-while-installing-python-docx/</link>
      <pubDate>Wed, 22 Jul 2020 12:31:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2020/2020-07-22t1231-could-not-find-function-xmlcheckversion-in-library-libxml2.-while-installing-python-docx/</guid>
      <description>&lt;p&gt;因为Anaconda3的python环境在pyinstaller打包的时候，会把整个数学运算库打包进来，使整个程序体积达到300M以上，在分析程序运行时加载的动态链接库时，发现这些库在运行过程中都没有使用，虽然可以手动删除这些库，但是每次打包好了都要手动删除未免过于繁琐，所以打算把python切换一下，由于电脑里面之前已经安装了python3.8，所以只需要吧Anaconda3的环境取消激活就可以了。&lt;/p&gt;

&lt;p&gt;但是项目中所用到的一些包，都要重新安装一遍了。其中就包括python-docx这个模块，在安装的过程中报了&lt;code&gt;Could not find function xmlCheckVersion in library libxml2. Is libxml2 installed?&lt;/code&gt;这个错误。百度了一下，是缺少lxml引起的，需要到&lt;code&gt;https://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml&lt;/code&gt;下载你所安装python版本的对应whl包，由于我的python是windows下的64位版本，于是我就下载了&lt;code&gt;lxml‑4.5.2‑cp38‑cp38‑win_amd64.whl&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;下载完成后，只需cd到该whl包的路径上，执行&lt;code&gt;pip install lxml‑4.5.2‑cp38‑cp38‑win_amd64.whl&lt;/code&gt;就可以了。但是在安装的过程中却又出了点状况，提示&lt;code&gt;lxml-4.5.2-cp38-cp38-win32.whl is not a supported wheel on this platform.&lt;/code&gt;，百度发现是包名有问题，在python控制台中输入&lt;code&gt;import pip._internal; print(pip._internal.pep425tags.get_supported())&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;可以看到&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[(&#39;cp38&#39;, &#39;cp38m&#39;, &#39;win_amd64&#39;), (&#39;cp38&#39;, &#39;none&#39;, &#39;win_amd64&#39;), (&#39;py3&#39;, &#39;none&#39;, &#39;win_amd64&#39;), (&#39;cp38&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;cp3&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;py38&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;py3&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;py37&#39;, &#39;none&#39;,
 &#39;any&#39;), (&#39;py36&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;py35&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;py34&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;py33&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;py32&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;py31&#39;, &#39;none&#39;, &#39;any&#39;), (&#39;py30&#39;, &#39;none&#39;, &#39;any&#39;)]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;按照第一个参数可知，将文件名修改为&lt;code&gt;lxml‑4.5.2‑cp38‑cp38m‑win_amd64.whl&lt;/code&gt;即可&lt;/p&gt;

&lt;p&gt;修改后，在该包对应的路径中执行&lt;code&gt;pip install lxml‑4.5.2‑cp38‑cp38m‑win_amd64.whl&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;可以看到&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;(newvenv) E:\checkDuplicate&amp;gt;pip install lxml-4.5.2-cp38-cp38m-win_amd64.whl
Processing e:\checkduplicate\lxml-4.5.2-cp38-cp38m-win_amd64.whl
Installing collected packages: lxml
Successfully installed lxml-4.5.2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;安装成功。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>一条命令｜康康谁动了我的vps</title>
      <link>http://blog.sinowrt.cn/2020/2020-06-28t1610-find-out-the-attacker-who-attacked-your-vps/</link>
      <pubDate>Sun, 28 Jun 2020 16:10:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2020/2020-06-28t1610-find-out-the-attacker-who-attacked-your-vps/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;今天无意中发现了一个非常有用的命令&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;lastb ss -t&lt;/code&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>帮酒店修复网络</title>
      <link>http://blog.sinowrt.cn/2020/2020-06-12t1436-help-bojue-hotel-to-repair-the-wireless/</link>
      <pubDate>Fri, 12 Jun 2020 14:36:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2020/2020-06-12t1436-help-bojue-hotel-to-repair-the-wireless/</guid>
      <description>

&lt;h3 id=&#34;0x00-事由&#34;&gt;0x00 事由&lt;/h3&gt;

&lt;p&gt;最近在外地出差，我住的酒店环境还不错，就是我这个房间的网络down了，提示宽带密码错误。
&lt;img src=&#34;http://pic.sinowrt.cn/image/2020-06-14T1436/wrong%20password.png&#34; alt=&#34;image&#34; /&gt;
于是我就连了楼上相同房间号的wifi。但是始终是隔着一层水泥板，信号不怎么好。于是我就想，那就进后台找一下宽带密码，修复一下我房间的wifi吧。&lt;/p&gt;

&lt;h3 id=&#34;0x01-步骤&#34;&gt;0x01 步骤&lt;/h3&gt;

&lt;p&gt;首先route -n get default查看默认网关，一般这种盒子的网关就是路由的管理后台地址，得到网关地址为192.168.125.1&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;sh-3.2# route -n get default 
   route to: default
destination: default
       mask: default
    gateway: 192.168.125.1
  interface: en0
      flags: &amp;lt;UP,GATEWAY,DONE,STATIC,PRCLONING&amp;gt;
 recvpipe  sendpipe  ssthresh  rtt,msec    rttvar  hopcount      mtu     expire
       0         0         0         0         0         0      1500         0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然后在浏览器输入地址192.168.125.1，打开后台登陆界面，还要输入用户名和密码&lt;/p&gt;

&lt;p&gt;根据经验输入最常见的用户名admin 密码admin，回车，进去了&lt;/p&gt;

&lt;p&gt;找到wan口设置，账户名直接能看到，密码用点号隐藏了，于是使出F12大法找到密码&lt;/p&gt;

&lt;p&gt;然后连到我房间这个路由器,进入后台把密码填进去就可以了，跟前面是一样的步骤，就不赘述了&lt;/p&gt;

&lt;p&gt;设置完保存&amp;amp;应用，等待设置生效后，ping一下看看网络通不通&lt;/p&gt;

&lt;p&gt;搞定！&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Macbook Pro 2019使用感受</title>
      <link>http://blog.sinowrt.cn/2020/2020-06-10t1511-the-using-feeling-of-mbp/</link>
      <pubDate>Wed, 10 Jun 2020 14:27:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2020/2020-06-10t1511-the-using-feeling-of-mbp/</guid>
      <description>&lt;p&gt;机器是今年年初买的，当时不想用公司的电脑，我就把神船带到公司当主力机。&lt;/p&gt;

&lt;p&gt;神船的性能是没得说的，但是这个重量(5kg)要背着上班通勤的话，我相信非习武之人绝对是承受不住的。&lt;/p&gt;

&lt;p&gt;于是我就打算将神船留在公司，可是回家就没电脑用了呀，而且身为IT人无论身在何处，随身携带电脑是我们光荣的使命。所以就萌发了购置macbook pro的想法。&lt;/p&gt;

&lt;p&gt;作为开发人员，16g内存是必选的，硬盘如果有条件还是建议512起步。但由于当时手头拮据，只选配了256的。新macbook pro在今年五月发布了，cpu 键盘 内存 硬盘 全线升级，如果上天再给我一次机会的话，我一定会等这四个月。&lt;/p&gt;

&lt;p&gt;使用macbook最直接的感受就是它超长的续航了，正常办公使用5h+没问题。而且随用随关，不用时只要把盖合上实属省心。&lt;/p&gt;

&lt;p&gt;现在我日常都是本地mac+远程win双端办公，只要有网络的地方都可以双端无缝切换，省心得很。&lt;/p&gt;

&lt;p&gt;macbook使用到现在也有小半年了，大问题没有，小问题比如说finder的远程服务器连接实属蹩脚，系统偶尔也会开小猜，不过重启都能解决问题。但是我这个人就是不喜欢重启电脑，只要不出问题，我宁愿它7x24不间断服务。&lt;/p&gt;

&lt;p&gt;前段时间还遇到了 macbook pro 2019 siri无法找到麦克风的问题，重启电脑即可解决。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Macbook Pro查看电池信息</title>
      <link>http://blog.sinowrt.cn/2020/2020-06-10t1427-how-to-query-the-information-of-battery-on-mac/</link>
      <pubDate>Wed, 10 Jun 2020 14:27:00 +0800</pubDate>
      
      <guid>http://blog.sinowrt.cn/2020/2020-06-10t1427-how-to-query-the-information-of-battery-on-mac/</guid>
      <description>&lt;p&gt;在终端输入以下命令：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;ioreg -rn AppleSmartBattery | grep -i capacity
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;&amp;quot;AppleRawCurrentCapacity&amp;quot; = 4867
&amp;quot;AppleRawMaxCapacity&amp;quot; = 5084
&amp;quot;MaxCapacity&amp;quot; = 5084
&amp;quot;CurrentCapacity&amp;quot; = 4867
&amp;quot;LegacyBatteryInfo&amp;quot; = {&amp;quot;Amperage&amp;quot;=18446744073709551214,&amp;quot;Flags&amp;quot;=4,&amp;quot;Capacity&amp;quot;=5084,&amp;quot;Current&amp;quot;=4867,&amp;quot;Voltage&amp;quot;=12729,&amp;quot;Cycle Count&amp;quot;=46}
&amp;quot;DesignCapacity&amp;quot; = 5088
&amp;quot;BatteryData&amp;quot; = {&amp;quot;StateOfCharge&amp;quot;=96,&amp;quot;PMUConfigured&amp;quot;=0,&amp;quot;Voltage&amp;quot;=12699,&amp;quot;QmaxCell1&amp;quot;=5358,&amp;quot;AdapterPower&amp;quot;=839469241,&amp;quot;SystemPower&amp;quot;=1087516262,&amp;quot;ResScale&amp;quot;=117,&amp;quot;QmaxCell2&amp;quot;=5302,&amp;quot;QmaxCell0&amp;quot;=5341,&amp;quot;CycleCount&amp;quot;=46,&amp;quot;DesignCapacity&amp;quot;=5088}
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>